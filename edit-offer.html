<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙˆÙƒØ§Ù„Ø©</title>

<style>
body{
  font-family:Tajawal,Arial;
  background:#f2f2f2;
  margin:0;
}
.container{
  max-width:900px;
  margin:40px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
}
h2{
  text-align:center;
  color:#8b0000;
}
label{font-weight:bold;margin-top:10px;display:block}
select,input{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  margin-top:15px;
  padding:12px;
  width:100%;
  background:#8b0000;
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}

.offer{
  border:1px solid #ddd;
  border-radius:10px;
  padding:15px;
  margin-top:15px;
  background:#fafafa;
}
.offer h4{
  margin:0 0 8px;
  color:#333;
}
.offer small{color:#666}
.edit-btn{
  background:#0066cc;
  margin-top:10px;
}
.hidden{display:none}
.error{color:red;text-align:center;margin-top:10px}
</style>
</head>

<body>

<div class="container">
<h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙˆÙƒØ§Ù„Ø©</h2>

<label>Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒØ§Ù„Ø©</label>
<select id="agencySelect">
  <option value="">-- Ø§Ø®ØªØ± --</option>
</select>

<label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„ÙˆÙƒØ§Ù„Ø© (Ù„Ù„ØªØ£ÙƒÙŠØ¯)</label>
<input id="phoneCheck" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

<button onclick="verifyAgency()">ğŸ” ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„</button>

<p class="error" id="errorMsg"></p>

<hr>

<div id="offersBox" class="hidden"></div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbx7sQEUTNhglETA_Irkc5UOvy62SvS-9ftS4v-Ugh8cnTQjDiNs6-kp-SdR8QsOnXE-zw/exec";

let allData = [];

// ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶
fetch(API)
.then(r=>r.json())
.then(data=>{
  allData = data;

  const agencies = [...new Set(data.map(o=>o.agency))];
  const select = document.getElementById("agencySelect");

  agencies.forEach(a=>{
    select.innerHTML += `<option value="${a}">${a}</option>`;
  });
});

function verifyAgency(){
  const agency = agencySelect.value;
  const phone = phoneCheck.value.trim();
  const error = document.getElementById("errorMsg");
  const box = document.getElementById("offersBox");

  error.textContent = "";
  box.innerHTML = "";
  box.classList.add("hidden");

  if(!agency || !phone){
    error.textContent = "âš ï¸ Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒØ§Ù„Ø© ÙˆØ£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ";
    return;
  }

  const offers = allData.filter(o => o.agency === agency && o.phone === phone);

  if(offers.length === 0){
    error.textContent = "âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶";
    return;
  }

  box.classList.remove("hidden");

  offers.forEach(o=>{
    box.innerHTML += `
      <div class="offer">
        <h4>${o.offer}</h4>
        <small>ğŸ“… ${o.date} | â± ${o.duration}</small><br>
        <small>âœˆï¸ ${o.airline} â€“ ${o.airport}</small><br>
        <small>ğŸ¨ ${o.hotel}</small>

        <button class="edit-btn" onclick="editOffer('${o.id || ''}')">
          âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
        </button>
      </div>
    `;
  });
}

function editOffer(id){
  alert("âœï¸ Ù‡Ù†Ø§ Ù†ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©)");
}
</script>

</body>
</html>
