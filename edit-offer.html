<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุชุนุฏูู ุนุฑูุถ ุงูููุงูุฉ</title>

<style>
body{font-family:Tajawal,Arial;background:#f2f2f2;margin:0}
.container{max-width:900px;margin:40px auto;background:#fff;padding:20px;border-radius:14px}
h2{text-align:center;color:#8b0000}
label{display:block;margin-top:12px;font-weight:bold}
input,select{
  width:100%;padding:10px;margin-top:5px;
  border:1px solid #ccc;border-radius:8px
}
	header{  
  height:60px;  
  background:#8b0000;  
  color:#fff;  
  display:flex;  
  align-items:center;  
  padding:0 15px;  
}  
.menu-btn{font-size:26px;cursor:pointer}  
header h1{flex:1;text-align:center;font-size:18px;margin:0}  
  
.whatsapp-top{  
  position:fixed;  
top:60px;                    
  left:12px;  
  width:48px;  
  height:48px;  
  background:#25D366;  
  color:#fff;  
  border-radius:50%;  
  display:flex;  
  align-items:center;  
  justify-content:center;  
  font-size:28px;  
  z-index:13000;  
}  
  
#sideMenu{  
  position:fixed;  
  top:0;right:-260px;  
  width:260px;height:100%;  
  background:#8b0000;  
  padding-top:70px;  
  transition:.3s;  
  z-index:10000  
}  
#sideMenu a{  
  display:block;  
  padding:14px 18px;  
  color:#fff;  
  text-decoration:none;  
}  
#overlay{  
  display:none;  
  position:fixed;  
  inset:0;  
  background:rgba(0,0,0,.6);  
  z-index:9000  
}  

	.visitor-box{
  display:flex;
  align-items:center;
  gap:10px;

  position:absolute;
  left:15px;          /* ุฃูุตู ุงููุณุงุฑ */
  top:50%;
  transform:translateY(-50%);

  background:rgba(255,255,255,.15);
  backdrop-filter:blur(6px);
  padding:12px 18px;
  border-radius:14px;
  font-family:Tajawal,Arial;
  width:max-content;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}
 
  
.visitor-box i{  
  font-size:20px;  
  color:#1e90ff;  
}  
  
.visitor-box span{  
color:#fff;  
  font-size:18px;  
  font-weight:700;  
}  
  
.visitor-box small{  
color:#fff;  
  font-size:13px;  
  opacity:.85;  
}  
header{  
  height:60px;  
  background:#8b0000;  
  color:#fff;  
  display:flex;  
  align-items:center;  
  gap:10px;  
  padding:0 15px;  
}  
  
header h1{  
  flex:1;  
  text-align:center;  
  font-size:18px;  
  margin:0;  
} 
.site-logo{
  position:absolute;
  left:62%;
  top:6px;                     /* ููุฒู ููููุงู ุฏุงุฎู ุงูุดุฑูุท */
  transform:translateX(-50%);
  
  height:58px;
  width:auto;
  cursor:pointer;
	 /* 3D effect */
  filter:drop-shadow(0 6px 10px rgba(0,0,0,.45));
  transform-style:preserve-3d;

  transition:transform .25s ease, filter .25s ease;
}
button{
  padding:12px;border:none;border-radius:10px;
  cursor:pointer;font-size:15px
}
.main{width:100%;background:#8b0000;color:#fff;margin-top:12px}
.offer{border:1px solid #ddd;border-radius:12px;padding:15px;margin-top:15px;background:#fafafa}
.actions{display:flex;gap:10px;margin-top:10px}
.actions button{flex:1}
.edit{background:#0066cc;color:#fff}
.delete{background:#b00000;color:#fff}
.msg{text-align:center;margin-top:10px;font-weight:bold}

/* modal */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;z-index:9999
}
.modal-box{
  background:#fff;width:95%;max-width:700px;
  border-radius:14px;padding:20px;
  max-height:90vh;overflow:auto
}
.save{background:#008000;color:#fff;width:100%;margin-top:15px}
.close{background:#ccc;width:100%;margin-top:10px}
.row{display:flex;gap:10px}
.row>div{flex:1}
  .add-btn{
  background:#008000;
  color:#fff;
}

</style>
</head>

<body>
<header class="top-bar">
  <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (ูููู) -->
  <div class="menu-btn" onclick="openMenu()">โฐ</div>
  <!-- ุงูุดุนุงุฑ (ูุณุท) -->
  <div class="logo-center" onclick="openWelcome()">
 <img
  src="https://res.cloudinary.com/dmc36nijl/image/upload/v1769426692/ei_1769426620917-removebg-preview_yuws6p.png"
  alt="ุทุฑูู ุงูุนูุฑุฉ"
  class="logo site-logo"
  onclick="openWelcome()">
  </div>
  <!-- ุนุฏุงุฏ ุงูุฒูุงุฑ (ูุณุงุฑ) -->
  <div class="visitor-box">
    <i class="fa-solid fa-users"></i>
    <div>
      <span id="visitors">0</span>
      <small>ุฒุงุฆุฑ</small>
    </div>
  </div>
</header>
	 <nav id="sideMenu">  
<a href="results-gen.html">๐ ุงูุนุฑูุถ ุงูุนุงูุฉ</a>  
<a href="recherche-oeffer.html">๐ฉ ุทูุจ ุนุฑุถ ุนูุฑุฉ</a>  
<a href="recherche-n.html">๐ค ุตูุญุชู ุงูุฎุงุตุฉ</a>  
</nav>  
<div class="container">
<h2>โ๏ธ ุฅุฏุงุฑุฉ ุนุฑูุถ ุงูููุงูุฉ</h2>
<a href="add-offer.html" class="nav-btn add-btn">
  โ ุฅุถุงูุฉ ุนุฑุถ ุฌุฏูุฏ
</a>

<label>ุงุฎุชุฑ ุงูููุงูุฉ</label>
<select id="agencySelect"><option value="">-- ุงุฎุชุฑ --</option></select>

<label>ุฑูู ุงูุฑุฎุตุฉ</label>
<input id="licenseInput" placeholder="ุฑูู ุงูุฑุฎุตุฉ">


<button class="main" onclick="loadOffers()">๐ ุฏุฎูู</button>
<p class="msg" id="msg"></p>

<hr>
<div id="offersBox"></div>
</div>

<!-- Modal -->
<div class="modal" id="editModal">
  <div class="modal-box">

    <h3 style="text-align:center;color:#8b0000">โ๏ธ ุชุนุฏูู ุงูุนุฑุถ</h3>
    <input type="hidden" id="editRow">

    <label>ุงุณู ุงูุนุฑุถ</label>
    <input id="offer">

    <div class="row">
      <div>
        <label>ุชุงุฑูุฎ ุงูุฑุญูุฉ</label>
        <input type="date" id="date">
      </div>
      <div>
        <label>ุงููุฏุฉ</label>
        <input id="duration">
      </div>
    </div>

    <label>ููุน ุงูุฑุญูุฉ</label>
    <select id="flightType">
      <option value="ูุจุงุดุฑุฉ">ูุจุงุดุฑุฉ</option>
      <option value="ุบูุฑ ูุจุงุดุฑุฉ">ุบูุฑ ูุจุงุดุฑุฉ</option>
    </select>

    <label>ูุทุงุฑ ุงูุฅููุงุน</label>
    <select id="airport">
      <option>ูุทุงุฑ ุงูุฌุฒุงุฆุฑ</option>
      <option>ูุทุงุฑ ููุฑุงู</option>
      <option>ูุทุงุฑ ูุณูุทููุฉ</option>
      <option>ูุทุงุฑ ุนูุงุจุฉ</option>
      <option>ูุทุงุฑ ุฌูุฌู</option>
      <option>ูุทุงุฑ ุจุงุชูุฉ</option>
      <option>ูุทุงุฑ ูุฑููุฉ</option>
      <option>ูุทุงุฑ ุชููุบุงุณุช</option>
      <option>ูุทุงุฑ ุฃุฏุฑุงุฑ</option>
      <option>ูุทุงุฑ ุงููุงุฏู</option>
      <option>ูุทุงุฑ ุบุฑุฏุงูุฉ</option>
    </select>



    <label>ุฌูุงุนูุฉ</label>
    <input id="group">

    <div class="row">
      <div><label>ุฑุจุงุนูุฉ</label><input id="four"></div>
      <div><label>ุซูุงุซูุฉ</label><input id="three"></div>
    </div>

 <label>ุซูุงุฆูุฉ</label>
<input id="two">

<label>ุงุณู ุงูููุฏู</label>
<input id="hotel">

<hr>

<label>ุดุนุงุฑ ุงูููุงูุฉ</label>
<input id="agencyLogo" placeholder="ุฑุงุจุท ุดุนุงุฑ ุงูููุงูุฉ">

<div style="text-align:center;margin:8px 0">
  <img id="agencyLogoPreview" style="max-width:120px;display:none">
</div>

<hr>

<label>ุดุฑูุฉ ุงูุทูุฑุงู</label>
<select id="airlineEdit">
  <option value="">ุงุฎุชุฑ ุดุฑูุฉ ุงูุทูุฑุงู</option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงูุฌุฒุงุฆุฑูุฉ"
    data-logo="https://res.cloudinary.com/dmc36nijl/image/upload/v1769278796/t%C3%A9l%C3%A9chargement_xi0dob.jpg">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงูุฌุฒุงุฆุฑูุฉ
  </option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงูุฃุฑุฏููุฉ"
    data-logo="https://res.cloudinary.com/dmc36nijl/image/upload/v1769285030/t%C3%A9l%C3%A9chargement_1_ocn0g5.jpg">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงูุฃุฑุฏููุฉ
  </option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงูุณุนูุฏูุฉ"
    data-logo="https://res.cloudinary.com/dmc36nijl/image/upload/v1769279850/250px-%D8%B4%D8%B9%D8%A7%D8%B1_%D8%A7%D9%84%D8%AE%D8%B7%D9%88%D8%B7_%D8%A7%D9%84%D8%B3%D8%B9%D9%88%D8%AF%D9%8A%D8%A9.svg_jmmkls.png">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงูุณุนูุฏูุฉ
  </option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงูุชุฑููุฉ"
    data-logo="https://res.cloudinary.com/dmc36nijl/image/upload/v1769279151/t%C3%A9l%C3%A9chargement_rwei2l.png">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงูุชุฑููุฉ
  </option>

  <option value="ููุงู ูุงุณ"
    data-logo="https://res.cloudinary.com/dmc36nijl/image/upload/v1769281370/images_6_b0u8c9.jpg">
    ููุงู ูุงุณ
  </option>

  <option value="ููููุงุฑ"
    data-logo="https://i.supaimg.com/7c39556f-f3bb-4475-b7a7-bd278b555927.png">
    ููููุงุฑ
  </option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงูุฅูุงุฑุงุชูุฉ"
    data-logo="https://upload.wikimedia.org/wikipedia/commons/d/d0/Emirates_logo.svg">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงูุฅูุงุฑุงุชูุฉ
  </option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงููุทุฑูุฉ"
    data-logo="https://res.cloudinary.com/dmc36nijl/image/upload/v1769279819/images_3_afxklx.jpg">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงููุทุฑูุฉ
  </option>

  <option value="ุงูุฎุทูุท ุงูุฌููุฉ ุงููุตุฑูุฉ"
    data-logo="https://i.supaimg.com/7862dbb4-97fd-4a1d-aa23-ccb4eac316c8.png">
    ุงูุฎุทูุท ุงูุฌููุฉ ุงููุตุฑูุฉ
  </option>

  <option value="ุทูุฑุงู ุฃุฏูู ุงูุณุนูุฏู"
    data-logo="https://i.ibb.co/GzhC6vQ/t-l-chargement-removebg-preview.png">
    ุทูุฑุงู ุฃุฏูู ุงูุณุนูุฏู
  </option>
</select>

<input type="hidden" id="airlineLogoEdit">

<div style="text-align:center;margin-top:8px">
  <img id="airlineLogoPreview" style="max-width:140px;display:none">
</div>

<button class="save" onclick="saveEdit()">๐พ ุญูุธ ุงูุชุนุฏููุงุช</button> <button class="close" onclick="closeModal()">ุฅูุบุงุก</button> </div> </div>

	<script>
const API = "https://script.google.com/macros/s/AKfycbz-uqNculXyfWmLik8OY6gRYIr75cswjomrJRjs25JFZccIkulsiRslXw3woZ6SPDEiMA/exec";

// ุนูุงุตุฑ ุงูุตูุญุฉ
const agencySelect = document.getElementById("agencySelect");
const licenseInput = document.getElementById("licenseInput");
const box = document.getElementById("offersBox");
const msg = document.getElementById("msg");
const editRow = document.getElementById("editRow");
const offer = document.getElementById("offer");
const date = document.getElementById("date");
const duration = document.getElementById("duration");
const flightType = document.getElementById("flightType");
const airport = document.getElementById("airport");
const group = document.getElementById("group");
const four = document.getElementById("four");
const three = document.getElementById("three");
const two = document.getElementById("two");
const hotel = document.getElementById("hotel");
const editModal = document.getElementById("editModal");

const agencyLogo = document.getElementById("agencyLogo");
const agencyLogoPreview = document.getElementById("agencyLogoPreview");

const airlineEdit = document.getElementById("airlineEdit");
const airlineLogoEdit = document.getElementById("airlineLogoEdit");
const airlineLogoPreview = document.getElementById("airlineLogoPreview");

let allOffers = [];

/* ุชุญููู ุงูุจูุงูุงุช */
fetch(API)
  .then(r => r.json())
  .then(data => {
    allOffers = data;
    [...new Set(data.map(o => o.agency))].forEach(a => {
      if (a) agencySelect.innerHTML += `<option>${a}</option>`;
    });
  });

/* ุนุฑุถ ุงูุนุฑูุถ */
function loadOffers() {
  const agency = agencySelect.value.trim();
  const inputLicense = licenseInput.value.trim();

  box.innerHTML = "";
  msg.textContent = "";

  if (!agency || !inputLicense) {
    msg.textContent = "โ๏ธ ูุฑุฌู ุงุฎุชูุงุฑ ุงูููุงูุฉ ูุฅุฏุฎุงู ุฑูู ุฑุฎุตุฉ ุงูููุงูุฉ";
    return;
  }

  const agencyRow = allOffers.find(o => String(o.agency || "").trim() === agency);

  if (!agencyRow) {
    msg.textContent = "โ ุงูููุงูุฉ ุบูุฑ ููุฌูุฏุฉ";
    return;
  }

  const sheetLicense = String(agencyRow.license || "").trim();
  if (sheetLicense !== inputLicense) {
    msg.textContent = "โ ุฑูู ุงูุฑุฎุตุฉ ุบูุฑ ุตุญูุญ";
    return;
  }

  const offers = allOffers.filter(o => String(o.agency || "").trim() === agency);
  if (!offers.length) {
    msg.textContent = "โ ูุง ุชูุฌุฏ ุนุฑูุถ";
    return;
  }

  offers.forEach(o => {
    const div = document.createElement("div");
    div.className = "offer";
    div.innerHTML = `
      <b>${o.offer}</b><br>
      <small>๐ ${o.date} | โฑ ${o.duration}</small><br>
      <small>๐จ ${o.hotel}</small>
      <div class="actions">
        <button class="edit">โ๏ธ ุชุนุฏูู</button>
        <button class="delete">๐๏ธ ุญุฐู</button>
      </div>
    `;
    // ุฒุฑ ุงูุชุนุฏูู
    div.querySelector(".edit").addEventListener("click", () => openEdit(o));
    // ุฒุฑ ุงูุญุฐู
    div.querySelector(".delete").addEventListener("click", () => deleteOffer(o.row));

    box.appendChild(div);
  });
}

/* ูุชุญ ูุงูุฐุฉ ุงูุชุนุฏูู */
function openEdit(o) {
  editRow.value = o.row || "";

  offer.value = o.offer || "";
  date.value = o.date || "";
  duration.value = o.duration || "";
  flightType.value = o.flightType || "";
  airport.value = o.airport || "";
  group.value = o.group || "";
  four.value = o.four || "";
  three.value = o.three || "";
  two.value = o.two || "";
  hotel.value = o.hotel || "";

  // ุดุนุงุฑ ุงูููุงูุฉ
  agencyLogo.value = o.agencyLogo || "";
  agencyLogoPreview.src = o.agencyLogo || "";
  agencyLogoPreview.style.display = o.agencyLogo ? "block" : "none";

  // ุดุฑูุฉ ุงูุทูุฑุงู + ุดุนุงุฑูุง
  airlineEdit.value = o.airline || "";
  airlineLogoEdit.value = o.airlineLogo || "";
  airlineLogoPreview.src = o.airlineLogo || "";
  airlineLogoPreview.style.display = o.airlineLogo ? "block" : "none";

  editModal.style.display = "flex";
}

/* ุฅุบูุงู ุงูููุฏุงู */
function closeModal() {
  editModal.style.display = "none";
}

/* ุญูุธ ุงูุชุนุฏููุงุช */
function saveEdit() {
  const fd = new FormData();
  fd.append("action", "update");
  fd.append("row", editRow.value);
  fd.append("license", licenseInput.value);

  ["offer","date","duration","flightType","airport",
   "group","four","three","two","hotel"].forEach(id =>
    fd.append(id, document.getElementById(id).value)
  );

  // ุฅุถุงูุฉ ุดุนุงุฑุงุช
  fd.append("agencyLogo", agencyLogo.value);
  fd.append("airline", airlineEdit.value);
  fd.append("airlineLogo", airlineLogoEdit.value);

  fetch(API, { method: "POST", body: fd })
    .then(r => r.text())
    .then(res => {
      alert(res);
      location.reload();
    });
}

/* ุญุฐู ุงูุนุฑุถ */
function deleteOffer(row) {
  if (!confirm("ูู ุฃูุช ูุชุฃูุฏุ")) return;

  const fd = new FormData();
  fd.append("action", "delete");
  fd.append("row", row);
  fd.append("license", licenseInput.value);

  fetch(API, { method: "POST", body: fd })
    .then(r => r.text())
    .then(res => {
      alert(res);
      location.reload();
    });
}

/* ูุนุงููุฉ ุดุนุงุฑ ุงูููุงูุฉ ุนูุฏ ุงููุชุงุจุฉ */
agencyLogo.addEventListener("input", () => {
  if (agencyLogo.value.trim()) {
    agencyLogoPreview.src = agencyLogo.value.trim();
    agencyLogoPreview.style.display = "block";
  } else {
    agencyLogoPreview.style.display = "none";
  }
});

/* ุชุบููุฑ ุดุนุงุฑ ุดุฑูุฉ ุงูุทูุฑุงู ุนูุฏ ุงุฎุชูุงุฑ ุดุฑูุฉ */
airlineEdit.addEventListener("change", () => {
  const opt = airlineEdit.selectedOptions[0];
  const logo = opt.getAttribute("data-logo");
  if (logo) {
    airlineLogoEdit.value = logo;
    airlineLogoPreview.src = logo;
    airlineLogoPreview.style.display = "block";
  } else {
    airlineLogoPreview.style.display = "none";
  }
});

/* ูุงูุฐุฉ ุงูุชุฑุญูุจ */
function openWelcome() {
  document.getElementById("welcomeModal").style.display = "flex";
}
function closeWelcome() {
  document.getElementById("welcomeModal").style.display = "none";
}
</script>

	
	
	
	

	<div id="welcomeModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:30000;
  align-items:center;
  justify-content:center;
" onclick="closeWelcome()">
  <div style="
    background:#fff;
    padding:25px;
    border-radius:18px;
    max-width:420px;
    width:90%;
    text-align:center;
    font-family:Tajawal,Arial;
  " onclick="event.stopPropagation()">

    <h2 style="color:#8b0000;margin-top:0">
      ูุฑุญุจูุง ุจูู ูู ุทุฑูู ุงูุนูุฑุฉ ๐
    </h2>

    <p>
      ูููุน <b>ุทุฑูู ุงูุนูุฑุฉ</b> ูุณููู ุนูููู ุชุตูุญ
      ุฃูุถู ุนุฑูุถ ุงูุนูุฑุฉ ูู ููุงูุงุช <b>ูุฑุฎุตุฉ ููุนุชูุฏุฉ</b>ุ
      ูุน ุชุณุฌูู ุณูู ููุนูููุงุช ูุงุถุญุฉ.
    </p>

    <p style="font-weight:bold;color:#0b5f3c">
      ููุชู ุตุงุฏูุฉโฆ ูุงูุทุฑูู ุนูููุง ุจุฅุฐู ุงููู ๐คฒ
    </p>

    <button onclick="closeWelcome()" style="
      margin-top:15px;
      padding:10px 20px;
      border:none;
      background:#8b0000;
      color:#fff;
      border-radius:10px;
      cursor:pointer;
    ">
      ุฅุบูุงู
    </button>
</body>
</html>
