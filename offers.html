<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>عروض العمرة</title>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .offers {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      border-radius: 12px;
      padding: 15px;
      color: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .card h2 {
      margin: 0 0 10px;
    }
    .card p {
      margin: 5px 0;
    }
    .btn {
      display: inline-block;
      margin: 8px 5px 0 0;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .share-btn {
      background: #0077ff;
      color: #fff;
    }
    .like-btn {
      background: #ff4081;
      color: #fff;
    }
    .like-count {
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <h1>✈️ عروض رحلات العمرة</h1>
  <div class="offers" id="offers"></div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTyCRa-FUh6a62brIHe7tg4YImWLVEuEjsaYtIQGeAxrqt8-dQzcfoH-uQ5H8YHG36soStv6Zuwbd4a/pub?output=csv";

    const airportColors = {
      "الجزائر": "#4CAF50",
      "تمنغاست": "#2196F3",
      "ورقلة": "#9C27B0",
      "وهران": "#FF9800",
      "عنابة": "#F44336",
      "قسنطينة": "#009688"
    };

    // استرجاع عدد الإعجابات من LocalStorage
    function getLikes(id) {
      return parseInt(localStorage.getItem("like_" + id) || "0");
    }

    // التحقق إن كان المستخدم ضغط لايك من قبل
    function hasLiked(id) {
      return localStorage.getItem("liked_" + id) === "true";
    }

    // التعامل مع زر الإعجاب
    function toggleLike(id, btn, countSpan) {
      if (hasLiked(id)) {
        alert("لقد أعجبت بهذا العرض من قبل ✅");
        return;
      }
      let likes = getLikes(id) + 1;
      localStorage.setItem("like_" + id, likes);
      localStorage.setItem("liked_" + id, "true");
      countSpan.textContent = likes;
    }

    // جلب البيانات
    fetch(sheetUrl)
      .then(res => res.text())
      .then(data => {
        let rows = data.split("\n").map(r => r.split(","));
        rows.shift(); // إزالة العناوين

        let offers = rows.map((r, i) => ({
          id: i,
          airport: r[0],
          date: new Date(r[1]),
          hotel: r[2],
          price: r[3]
        }));

        // ترتيب حسب التاريخ
        offers.sort((a, b) => a.date - b.date);

        const container = document.getElementById("offers");

        offers.forEach(offer => {
          let card = document.createElement("div");
          card.className = "card";
          card.style.background = airportColors[offer.airport] || "#666";

          let dateStr = offer.date.toLocaleDateString("ar-DZ");

          card.innerHTML = `
            <h2>${offer.airport}</h2>
            <p>📅 ${dateStr}</p>
            <p>🏨 ${offer.hotel}</p>
            <p>💰 ${offer.price} دج</p>
          `;

          // زر المشاركة العام
          let shareBtn = document.createElement("button");
          shareBtn.className = "btn share-btn";
          shareBtn.textContent = "📤 مشاركة العرض";
          shareBtn.onclick = () => {
            const text = `🌟 عرض عمرة 🌟\nمن مطار ${offer.airport}\n📅 ${dateStr}\n🏨 ${offer.hotel}\n💰 ${offer.price} دج\n👉 الرابط: ${window.location.href}`;
            if (navigator.share) {
              navigator.share({ title: "عرض عمرة", text, url: window.location.href });
            } else {
              navigator.clipboard.writeText(text);
              alert("تم نسخ العرض ✅");
            }
          };

          // زر الإعجاب
          let likeBtn = document.createElement("button");
          likeBtn.className = "btn like-btn";

          let countSpan = document.createElement("span");
          countSpan.className = "like-count";
          countSpan.textContent = getLikes(offer.id);

          likeBtn.innerHTML = "👍 أعجبني ";
          likeBtn.prepend(countSpan);

          likeBtn.onclick = () => toggleLike(offer.id, likeBtn, countSpan);

          card.appendChild(shareBtn);
          card.appendChild(likeBtn);

          container.appendChild(card);
        });
      });
  </script>
</body>
</html>