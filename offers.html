<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</title>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .offers {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      border-radius: 12px;
      padding: 15px;
      color: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .card h2 {
      margin: 0 0 10px;
    }
    .card p {
      margin: 5px 0;
    }
    .btn {
      display: inline-block;
      margin: 8px 5px 0 0;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .share-btn {
      background: #0077ff;
      color: #fff;
    }
    .like-btn {
      background: #ff4081;
      color: #fff;
    }
    .like-count {
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <h1>âœˆï¸ Ø¹Ø±ÙˆØ¶ Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ø±Ø©</h1>
  <div class="offers" id="offers"></div>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTyCRa-FUh6a62brIHe7tg4YImWLVEuEjsaYtIQGeAxrqt8-dQzcfoH-uQ5H8YHG36soStv6Zuwbd4a/pub?output=csv";

    const airportColors = {
      "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": "#4CAF50",
      "ØªÙ…Ù†ØºØ§Ø³Øª": "#2196F3",
      "ÙˆØ±Ù‚Ù„Ø©": "#9C27B0",
      "ÙˆÙ‡Ø±Ø§Ù†": "#FF9800",
      "Ø¹Ù†Ø§Ø¨Ø©": "#F44336",
      "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©": "#009688"
    };

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ù…Ù† LocalStorage
    function getLikes(id) {
      return parseInt(localStorage.getItem("like_" + id) || "0");
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¶ØºØ· Ù„Ø§ÙŠÙƒ Ù…Ù† Ù‚Ø¨Ù„
    function hasLiked(id) {
      return localStorage.getItem("liked_" + id) === "true";
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨
    function toggleLike(id, btn, countSpan) {
      if (hasLiked(id)) {
        alert("Ù„Ù‚Ø¯ Ø£Ø¹Ø¬Ø¨Øª Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† Ù‚Ø¨Ù„ âœ…");
        return;
      }
      let likes = getLikes(id) + 1;
      localStorage.setItem("like_" + id, likes);
      localStorage.setItem("liked_" + id, "true");
      countSpan.textContent = likes;
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    fetch(sheetUrl)
      .then(res => res.text())
      .then(data => {
        let rows = data.split("\n").map(r => r.split(","));
        rows.shift(); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†

        let offers = rows.map((r, i) => ({
          id: i,
          airport: r[0],
          date: new Date(r[1]),
          hotel: r[2],
          price: r[3]
        }));

        // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
        offers.sort((a, b) => a.date - b.date);

        const container = document.getElementById("offers");

        offers.forEach(offer => {
          let card = document.createElement("div");
          card.className = "card";
          card.style.background = airportColors[offer.airport] || "#666";

          let dateStr = offer.date.toLocaleDateString("ar-DZ");

          card.innerHTML = `
            <h2>${offer.airport}</h2>
            <p>ğŸ“… ${dateStr}</p>
            <p>ğŸ¨ ${offer.hotel}</p>
            <p>ğŸ’° ${offer.price} Ø¯Ø¬</p>
          `;

          // Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¹Ø§Ù…
          let shareBtn = document.createElement("button");
          shareBtn.className = "btn share-btn";
          shareBtn.textContent = "ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¹Ø±Ø¶";
          shareBtn.onclick = () => {
            const text = `ğŸŒŸ Ø¹Ø±Ø¶ Ø¹Ù…Ø±Ø© ğŸŒŸ\nÙ…Ù† Ù…Ø·Ø§Ø± ${offer.airport}\nğŸ“… ${dateStr}\nğŸ¨ ${offer.hotel}\nğŸ’° ${offer.price} Ø¯Ø¬\nğŸ‘‰ Ø§Ù„Ø±Ø§Ø¨Ø·: ${window.location.href}`;
            if (navigator.share) {
              navigator.share({ title: "Ø¹Ø±Ø¶ Ø¹Ù…Ø±Ø©", text, url: window.location.href });
            } else {
              navigator.clipboard.writeText(text);
              alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¹Ø±Ø¶ âœ…");
            }
          };

          // Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨
          let likeBtn = document.createElement("button");
          likeBtn.className = "btn like-btn";

          let countSpan = document.createElement("span");
          countSpan.className = "like-count";
          countSpan.textContent = getLikes(offer.id);

          likeBtn.innerHTML = "ğŸ‘ Ø£Ø¹Ø¬Ø¨Ù†ÙŠ ";
          likeBtn.prepend(countSpan);

          likeBtn.onclick = () => toggleLike(offer.id, likeBtn, countSpan);

          card.appendChild(shareBtn);
          card.appendChild(likeBtn);

          container.appendChild(card);
        });
      });
  </script>
</body>
</html>