<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ูููุฐุฌ ุชุณุฌูู ุงูุนูุฑุฉ</title>
<style>
  * { box-sizing: border-box; }
  body {
    background: url('https://i.postimg.cc/JhKnMv57/FB-IMG-1753464094985.jpg') no-repeat center center fixed;
    background-size: cover;
    font-family: 'Tahoma', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 0;
  }
  .container {
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(5px);
    max-width: 450px;
    width: 90%;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    padding: 20px;
  }
  .step { display: none; }
  .step.active { display: block; }
  input, select { width: 100%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; }
  h2 {
    text-align: center;
    margin-bottom: 20px;
    background: rgba(255,255,255,0.4);
    padding: 10px;
    border-radius: 8px;
  }
  label {
    display: block;
    font-weight: bold;
    margin-top: 15px;
    padding: 5px 10px;
    border-radius: 6px;
    background: rgba(255,255,255,0.6);
  }
  button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #007bff;
    color: white;
    font-size: 1rem;
    transition: 0.3s;
  }
  button:hover { background: #0056b3; }
  .buttons { display: flex; gap: 10px; justify-content: space-between; }
  .remove-companion-btn { background:red; padding:5px 10px; margin-top:5px; border:none; border-radius:5px; color:white; cursor:pointer; }
  .popup-box {
    display: none;
    text-align: center;
    padding: 20px;
    background: rgba(255,255,255,0.9);
    max-width: 500px;
    margin: 30px auto;
    border-radius: 15px;
    backdrop-filter: blur(6px);
    box-shadow:0 0 15px rgba(0,0,0,0.2);
  }
  .popup-box h3 { margin-bottom:15px; background: rgba(255,255,255,0.6); padding:12px; border-radius:10px; }
  @media (max-width:480px) {
    .container { padding: 15px; }
    h2 { font-size:1.3rem; }
    input, select, button { font-size:0.95rem; padding:10px; }
  }
</style>
</head>
<body>

<form id="umrahForm" class="container">
  <!-- ุงูุฎุทูุฉ 0: ุงุฎุชูุงุฑ ุงูููุงูุฉ -->
  <div class="step active" id="step0">
    <h2>ูุนูููุงุช ุงูุนุฑุถ</h2>
    <label for="agencyDisplay">ุงุณู ุงูููุงูุฉ:</label>
    <select id="agencyDisplay" required onchange="updateBranches()">
      <option value="" disabled selected>ุงุฎุชุฑ ุงูููุงูุฉ</option>
      <option value="ููุงูุฉ ุชูุฑุช ููุณูุงุญุฉ ู ุณูุฑ">ููุงูุฉ ุชูุฑุช ููุณูุงุญุฉ ู ุณูุฑ</option>
    </select>
    <input type="hidden" id="agencyName" name="agencyName">
    <div class="buttons">
      <button type="button" onclick="nextStep()">ุงูุชุงูู</button>
    </div>
  </div>

  <!-- ุงูุฎุทูุฉ 1: ูุนูููุงุช ุงูุฒุจูู -->
  <div class="step" id="step1">
    <h2>ูุนูููุงุช ุงูุฒุจูู</h2>
    <label for="firstName">ุงูุงุณู:</label>
    <input type="text" id="firstName" name="firstName" required>
    <label for="lastName">ุงูููุจ:</label>
    <input type="text" id="lastName" name="lastName" required>
    <label for="phone">ุฑูู ุงููุงุชู:</label>
    <input type="tel" id="phone" name="phone" required>
    <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
    <input type="email" id="email" name="email" required>
    <label for="age">ุงูุนูุฑ:</label>
    <input type="number" id="age" name="age" min="0" required>
    <label for="passportExpiry">ุชุงุฑูุฎ ุงูุชูุงุก ุฌูุงุฒ ุงูุณูุฑ:</label>
    <input type="date" id="passportExpiry" name="passportExpiry" required>
    <div class="buttons">
      <button type="button" onclick="prevStep()">ุงูุณุงุจู</button>
      <button type="button" onclick="nextStep()">ุงูุชุงูู</button>
    </div>
  </div>

  <!-- ุงูุฎุทูุฉ 2: ุงูููุงูุฉ ูุงููุฑุน -->
  <div class="step" id="step2">
    <h2>ุงุฎุชูุงุฑ ุงูููุงูุฉ ูุงููุฑุน</h2>
    <label for="wilaya">ุงูููุงูุฉ:</label>
    <select id="wilaya" name="wilaya" required></select>
    <label for="branch">ุงููุฑุน ุงูุฃูุฑุจ:</label>
    <select id="branch" name="branch" required>
      <option value="" disabled selected>ุงุฎุชุฑ ุงููุฑุน</option>
    </select>
    <div class="buttons">
      <button type="button" onclick="prevStep()">ุงูุณุงุจู</button>
      <button type="button" onclick="nextStep()">ุงูุชุงูู</button>
    </div>
  </div>

  <!-- ุงูุฎุทูุฉ 3: ุงููุฑุงูููู ููุชุฑุฉ ุงูุฐูุงุจ -->
  <div class="step" id="step3">
    <h2>ุงููุฑุงูููู ูุงุฎุชูุงุฑ ุงููุชุฑุฉ</h2>
    <label for="roomType">ููุน ุงูุบุฑูุฉ:</label>
    <select id="roomType" name="roomType" required>
      <option value="" disabled selected>ุงุฎุชุฑ ููุน ุงูุบุฑูุฉ</option>
      <option value="ุบุฑูุฉ ุซูุงุฆูุฉ">ุบุฑูุฉ ุซูุงุฆูุฉ</option>
      <option value="ุบุฑูุฉ ุซูุงุซูุฉ">ุบุฑูุฉ ุซูุงุซูุฉ</option>
      <option value="ุบุฑูุฉ ุฑุจุงุนูุฉ">ุบุฑูุฉ ุฑุจุงุนูุฉ</option>
      <option value="ุบุฑูุฉ ุฎูุงุณูุฉ">ุบุฑูุฉ ุฎูุงุณูุฉ</option>
      <option value="ุบุฑูุฉ ุฌูุงุนูุฉ">ุบุฑูุฉ ุฌูุงุนูุฉ</option>
    </select>
    <label for="reservationType">ุตูุฉ ุงูุญุฌุฒ:</label>
    <select id="reservationType" name="reservationType" required onchange="toggleCompanionSection()">
      <option value="" disabled selected>ุงุฎุชุฑ ุตูุฉ ุงูุญุฌุฒ</option>
      <option value="ูููุฑุฏ">ูููุฑุฏ</option>
      <option value="ูุน ุตุฏูู">ูุน ุตุฏูู</option>
      <option value="ูุน ุงูุฃุณุฑุฉ">ูุน ุงูุฃุณุฑุฉ</option>
    </select>

    <label for="startDate">ูุชุฑุฉ ุงูุฐูุงุจ - ูู:</label>
    <input type="date" id="startDate" name="startDate" required>
    <label for="endDate">ุฅูู:</label>
    <input type="date" id="endDate" name="endDate" required>

    <div id="companionsSection" style="display:none;">
      <div id="companionsContainer"></div>
      <button type="button" onclick="addCompanion()">โ ุฅุถุงูุฉ ูุฑุงูู</button>
    </div>

    <div class="buttons">
      <button type="button" onclick="prevStep()">ุงูุณุงุจู</button>
      <button type="button" onclick="nextStep()">ุงูุชุงูู</button>
    </div>
  </div>

  <!-- ุงูุฎุทูุฉ 4: ุงูุดุฑูุท -->
  <div class="step" id="step4">
    <h2>ุงูุดุฑูุท ูุงูุฃุญูุงู</h2>
    <div style="max-height:200px; overflow-y:auto; border:1px solid #ccc; padding:10px;">
      <p>โจ <strong>ุทุฑูู ุงูุนูุฑุฉ</strong> ููุตุฉ ุฌุฒุงุฆุฑูุฉ ูุชุณููู ุงูุชุณุฌูู ุจุฏูู ุฏูุน ุฅููุชุฑููู.</p>
      

<p>๐ ุงููุดุฑูุน ูู ุฅูุฌุงุฒ <strong>ุทู ุจุฑูููุฉ</strong>ุ ูุฑุงูู ูุนุชูุฏ ูุฏู ููุงูุฉ <strong>ุชูุฑุช ููุณูุงุญุฉ ูุงูุณูุฑ</strong>.</p>
      <p>๐ ูุฑุฌู ุงูุชุฃูุฏ ูู ุตุญุฉ ุงููุนูููุงุช ูุจู ุงูุฅุฑุณุงู.</p>
      <p>๐ ุงูููุงููุฉ ุนูู ุงูุดุฑูุท ุชุนุชุจุฑ ุฅูุฒุงููุฉ.</p>
    </div>
    <label>
      <input type="checkbox" name="agree" required> ุฃูุงูู ุนูู ุงูุดุฑูุท ูุงูุฃุญูุงู
    </label>
    <div class="buttons">
      <button type="button" onclick="prevStep()">ุงูุณุงุจู</button>
      <button type="submit">ุฅุฑุณุงู ุงูุทูุจ</button>
    </div>
  </div>
</form>

<!-- ูุงูุฐุฉ ุงูุงูุชุธุงุฑ -->
<div id="message" class="popup-box">
  <h3>โณ ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ <span id="countdown">10</span> ุซูุงูู...</h3>
  <p>โจ ูุง ุชูุณู ุงูุงุณุชุบูุงุฑ ุฃุซูุงุก ุงูุงูุชุธุงุฑ โจ</p>
</div>

<!-- ูุงูุฐุฉ ุฎูุงุฑ ุชุญููู ุฌูุงุฒ ุงูุณูุฑ -->
<div id="passportChoice" class="popup-box">
  <h3>๐ ูู ุชุฑุบุจ ูู ุชุญููู ุตูุฑ ุฌูุงุฒ ุงูุณูุฑ ุงูุขูุ</h3>
  <button onclick="location.href='upload.html'">๐ค ูุนูุ ุฃุฑูุฏ ุชุญููู ุงูุตูุฑ</button>
  <button onclick="location.href='index.html'">โญ๏ธ ูุงุ ุณุฃุญูููุง ูุงุญููุง</button>
</div>

<script>
let currentStep = 0;
const steps = document.querySelectorAll('.step');
function showStep(index) {
  steps.forEach((step,i) => step.classList.toggle('active', i===index));
}
function nextStep() {
  if(currentStep<steps.length-1) { currentStep++; showStep(currentStep); }
}
function prevStep() {
  if(currentStep>0) { currentStep--; showStep(currentStep); }
}

window.addEventListener('DOMContentLoaded',()=>{
  // ุฅุฏุฑุงุฌ ุงูููุงูุงุช
  const wilayas = ["ุฃุฏุฑุงุฑ","ุงูุดูู","ุงูุฃุบูุงุท","ุฃู ุงูุจูุงูู","ุจุงุชูุฉ","ุจุฌุงูุฉ","ุจุณูุฑุฉ","ุจุดุงุฑ","ุงูุจููุฏุฉ","ุงูุจููุฑุฉ","ุชููุฑุงุณุช","ุชุจุณุฉ","ุชููุณุงู","ุชูุงุฑุช","ุชูุฒู ูุฒู","ุงูุฌุฒุงุฆุฑ","ุงูุฌููุฉ","ุฌูุฌู","ุณุทูู","ุณุนูุฏุฉ","ุณูููุฏุฉ","ุณูุฏู ุจูุนุจุงุณ","ุนูุงุจุฉ","ูุงููุฉ","ูุณูุทููุฉ","ุงููุฏูุฉ","ูุณุชุบุงูู","ุงููุณููุฉ","ูุนุณูุฑ","ูุฑููุฉ","ููุฑุงู","ุงูุจูุถ","ุฅููุฒู","ุจุฑุฌ ุจูุนุฑูุฑูุฌ","ุจููุฑุฏุงุณ","ุงูุทุงุฑู","ุชูุฏูู","ุชูุณูุณููุช","ุงููุงุฏู","ุฎูุดูุฉ","ุณูู ุฃูุฑุงุณ","ุชูุจุงุฒุฉ","ูููุฉ","ุนูู ุงูุฏููู","ุงููุนุงูุฉ","ุนูู ุชููุดูุช","ุบุฑุฏุงูุฉ","ุบููุฒุงู","ุชููููู","ุจุฑุฌ ุจุงุฌู ูุฎุชุงุฑ","ุฃููุงุฏ ุฌูุงู","ุจูู ุนุจุงุณ","ุฅู ุตุงูุญ","ุฅู ูุฒุงู","ุชูุฑุช","ุฌุงูุช","ุงููุบูุฑ","ุงููููุนุฉ"];
  const wilayaSelect = document.getElementById('wilaya');
  wilayas.forEach(w=>{ let opt=document.createElement('option'); opt.value=w; opt.textContent=w; wilayaSelect.appendChild(opt); });

  showStep(currentStep);
});

// ุชุญุฏูุซ ุงููุฑูุน ุญุณุจ ุงูููุงูุฉ
const agencyBranches = {
  "ููุงูุฉ ุชูุฑุช ููุณูุงุญุฉ ู ุณูุฑ":["ุชูุฑุช","ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ ุญุงููุง ุฎููุณ ุงูุฎุดูุฉ","ุจููุฑุฏุงุณ","ุณุทูู","ุงููุบูุฑ","ุงูุฌููุฉ","ุงููุฏูุฉ","ูุณุชุบุงูู","ุจุดุงุฑ","ุงูุดูู","ุนูุงุจุฉ","ุชููุฑุงุณุช","ูุณูุทููุฉ ููุงูุฉ ุงูุณูููุฉ","ุฌูุฌู ููุงูุฉ ุงูุณูููุฉ","ููุฑุงู","ุณูููุฏุฉ ููุงูุฉ ุงูุณูููุฉ","ุณูู ุฃูุฑุงุณ ููุงูุฉ ุงูุณูููุฉ","ูููุฉ ููุงูุฉ ุงูุณูููุฉ"]
};
function updateBranches(){
  const branchSelect = document.getElementById('branch');
  branchSelect.innerHTML='<option value="" disabled selected>ุงุฎุชุฑ ุงููุฑุน</option>';
  const selectedAgency = document.getElementById('agencyDisplay').value;
  if(selectedAgency && agencyBranches[selectedAgency]){
    agencyBranches[selectedAgency].forEach(b=>{
      let opt=document.createElement('option'); opt.value=b; opt.textContent=b; branchSelect.appendChild(opt);
    });
  }
  document.getElementById('agencyName').value=selectedAgency;
}

// ุฅุถุงูุฉ ุงููุฑุงูููู
let companionCount=0;
function addCompanion(){
  companionCount++;
  const container=document.getElementById('companionsContainer');
  const div=document.createElement('div');
  div.innerHTML=`
    <fieldset style="margin:10px 0;padding:10px;border:1px solid #ccc;">
      <legend>ุงููุฑุงูู ${companionCount}</legend>
      <label>ุงูุตูุฉ:</label>
      <select name="companionRelation${companionCount}" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ุฒูุฌุฉ">ุฒูุฌุฉ</option>
        <option value="ุงุจู">ุงุจู</option>
        <option value="ุงุจูุฉ">ุงุจูุฉ</option>
        <option value="ุฃุฎ">ุฃุฎ</option>
        <option value="ุฃุฎุช">ุฃุฎุช</option>
        <option value="ุฃู">ุฃู</option>
        <option value="ุฃุจ">ุฃุจ</option>
      </select>
      <label>ุงูุงุณู ุงููุงูู:</label>
      <input type="text" name="companionName${companionCount}" required>
      <label>ุชุงุฑูุฎ ุงููููุงุฏ:</label>
      <input type="date" name="companionBirth${companionCount}" required>
      <label>ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฌูุงุฒ:</label>
      <input type="date" name="companionPassport${companionCount}" required>
      <button type="button" class="remove-companion-btn" onclick="this.parentElement.remove()">๐๏ธ ุฅุฒุงูุฉ</button>
    </fieldset>`;
  container.appendChild(div);
}

// ุฅุธูุงุฑ ุฃู ุฅุฎูุงุก ูุณู ุงููุฑุงูููู ุญุณุจ ููุน ุงูุญุฌุฒ
function toggleCompanionSection(){
  const type = document.getElementById('reservationType').value;
  const companionsDiv=document.getElementById('companionsSection');
  companionsDiv.style.display=(type==='ูููุฑุฏ')?'none':'block';
}

// ุถุจุท ุชูุงุฑูุฎ ุงูุนูุฏุฉ
const startDate=document.getElementById('startDate');
const endDate=document.getElementById('endDate');
startDate.addEventListener('change',()=>{
  endDate.min=startDate.value;
  if(endDate.value<startDate.value) endDate.value=startDate.value;
});

// ุฅุฑุณุงู ุงููููุฐุฌ
document.getElementById('umrahForm').addEventListener('submit',function(e){
  e.preventDefault();
  const form=this;
  const formData=new FormData(form);

  const companions=[];
  document.querySelectorAll('#companionsContainer fieldset').forEach((fieldset,i)=>{
    const relation=fieldset.querySelector(`select[name="companionRelation${i+1}"]`)?.value||"";
    const name=fieldset.querySelector(`input[name="companionName${i+1}"]`)?.value||"";
    const birth=fieldset.querySelector(`input[name="companionBirth${i+1}"]`)?.value||"";
    const passport=fieldset.querySelector(`input[name="companionPassport${i+1}"]`)?.value||"";
    if(name) companions.push(`${relation}: ${name} - ูููุงุฏ: ${birth} - ุงูุชูุงุก ุฌูุงุฒ: ${passport}`);
  });
  formData.append('companions', companions.join(' | '));

  document.getElementById('message').style.display='block';
  form.style.display='none';

  fetch('https://script.google.com/macros/s/AKfycbwbxMHpUMcOfzk2CqdMbFM0EWij31KkPDMgNAQ-pqmXfVh15Rbxw5VokqhYUrOibq9-ag/exec',{
    method:'POST', body:formData
  })
  .then(res=>res.text())
  .then(res=>{
    let counter=10;
    const countdownElem=document.getElementById('countdown');
    const interval=setInterval(()=>{
      counter--;
      countdownElem.textContent=counter;
      if(counter===0){
        clearInterval(interval);
        alert("โ ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ!");
        document.getElementById('message').style.display='none';
        document.getElementById('passportChoice').style.display='block';
      }
    },1000);
  })
  .catch(err=>{
    alert("โ ุญุฏุซ ุฎุทุฃ: "+err.message);
    form.style.display='block';
    document.getElementById('message').style.display='none';
  });
});
</script>
</body>
</html>