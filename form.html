<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ø±Ø©</title>
  <style>
    * { box-sizing: border-box; }
    body {
      background: url('https://i.postimg.cc/JhKnMv57/FB-IMG-1753464094985.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0; padding: 0;
      font-family: 'Tahoma', sans-serif;
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh;
    }
    .container {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(5px);
      max-width: 450px; width: 90%;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      padding: 20px;
    }
    .step { display: none; }
    .step.active { display: block; }
    input, select {
      width: 100%; padding: 10px; margin: 10px 0;
      border: 1px solid #ccc; border-radius: 8px;
      font-size: 1rem;
    }
    h2 {
      text-align: center;
      color: #222; font-size: 1.5rem;
      margin-bottom: 20px;
      background-color: rgba(255,255,255,0.4);
      backdrop-filter: blur(4px);
      border-radius: 8px; padding: 10px;
    }
    label {
      display: block; font-weight: bold; color: #222;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(4px);
      padding: 5px 10px; border-radius: 6px;
      margin-top: 15px;
    }
    button {
      width: 100%; padding: 12px;
      border: none; border-radius: 8px;
      background: #007bff; color: white;
      font-size: 1rem; margin-top: 10px;
      cursor: pointer; transition: background 0.3s ease;
    }
    button:hover { background: #0056b3; }
    .buttons { display: flex; justify-content: space-between; gap: 10px; }
    .remove-companion-btn {
      background: red; color: white;
      padding: 5px 10px; border-radius: 5px;
      border: none; cursor: pointer; margin-top: 5px;
    }
    .popup-box {
      display: none; text-align: center;
      padding: 20px; background: rgba(255,255,255,0.9);
      margin: 30px auto; max-width: 500px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      backdrop-filter: blur(6px);
      color: #222; font-size: 18px;
      position: relative; z-index: 1000;
    }
    .popup-box h3 {
      font-size: 22px; font-weight: bold; color: #111;
      margin-bottom: 15px; background: rgba(255,255,255,0.6);
      padding: 12px; border-radius: 10px;
      backdrop-filter: blur(3px);
    }
    .popup-box p {
      font-size: 17px; color: #444; margin: 10px 0;
    }
    .popup-box button {
      margin: 8px; padding: 10px 20px;
      border: none; border-radius: 8px;
      background-color: #007bff; color: white;
      font-weight: bold; font-size: 16px;
      cursor: pointer; transition: background 0.3s ease;
    }
    .popup-box button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

<form id="umrahForm">
  <div class="step active" id="step0">
    <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</h2>

    <label for="offerNumber">Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶:</label>  
    <input type="text" id="offerNumber" name="offerNumber" value="0" readonly>

    <label for="agencyDisplay">Ø§Ø³Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø©:</label>
    <select id="agencyDisplay" required>
      <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒØ§Ù„Ø©</option>
      <option value="ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø³Ù‚ÙŠÙØ© Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø³Ù‚ÙŠÙØ© Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±</option>
      <option value="ÙˆÙƒØ§Ù„Ø© ØªÙ‚Ø±Øª Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±">ÙˆÙƒØ§Ù„Ø© ØªÙ‚Ø±Øª Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±</option>
    </select>
    <input type="hidden" id="agencyName" name="agency">

    <div class="buttons">
      <button type="button" onclick="nextStep()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
  </div>

  <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®Ø·ÙˆØ§Øª (step1, step2, step3, step4) ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ ÙƒÙˆØ¯Ùƒ -->

</form>

<!-- âœ… Ø±Ø³Ø§Ø¦Ù„ Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="message" class="popup-box">
  <h3>â³ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± <span id="countdown">10</span> Ø«ÙˆØ§Ù†ÙŠ...</h3>
  <p>âœ¨ Ù„Ø§ ØªÙ†Ø³Ù Ø§Ù„Ø§Ø³ØªØºÙØ§Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± âœ¨</p>
</div>

<div id="passportChoice" class="popup-box">
  <h3>ğŸ“„ Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ± Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ± Ø§Ù„Ø¢Ù†ØŸ</h3>
  <button onclick="location.href='upload.html'">ğŸ“¤ Ù†Ø¹Ù…ØŒ Ø£Ø±ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±</button>
  <button onclick="location.href='index.html'">â­ï¸ Ù„Ø§ØŒ Ø³Ø£Ø­Ù…Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§</button>
</div>

<script>
  let currentStep = 0;
  const steps = document.querySelectorAll('.step');
  showStep(currentStep);

  function showStep(index) {
    steps.forEach((step, i) => step.classList.toggle('active', i === index));
  }

  function nextStep() {
    const inputs = steps[currentStep].querySelectorAll('input, select');
    for (let input of inputs) {
      if (input.required && !input.value) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
        return;
      }
    }
    if (currentStep < steps.length - 1) {
      currentStep++;
      showStep(currentStep);
    }
  }

  function prevStep() {
    if (currentStep > 0) {
      currentStep--;
      showStep(currentStep);
    }
  }

  // ØªØ¹ÙŠÙŠÙ† Ø§Ø³Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
  document.getElementById("agencyDisplay").addEventListener("change", function () {
    document.getElementById("agencyName").value = this.value;

    // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙƒØ§Ù„Ø©ØŒ Ø¹Ø±Ø¶ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø§
    const agency = this.value;
    const branchSelect = document.getElementById("branch");
    branchSelect.innerHTML = ""; // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø£ÙˆÙ„Ù‹Ø§

    const agencyBranches = {
      "ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø³Ù‚ÙŠÙØ© Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±": ["Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©", "Ø¬ÙŠØ¬Ù„", "Ø¹Ù†Ø§Ø¨Ø©", "Ø³ÙƒÙŠÙƒØ¯Ø©", "Ø³ÙˆÙ‚ Ø§Ù‡Ø±Ø§Ø³", "Ù…ÙŠÙ„Ø©"],
      "ÙˆÙƒØ§Ù„Ø© ØªÙ‚Ø±Øª Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±": ["ØªÙ‚Ø±Øª", "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³", "Ø§Ù„Ù…ØºÙŠØ±", "Ø§Ù„Ø¬Ù„ÙØ©", "Ø§Ù„Ù…Ø¯ÙŠØ©", "Ù…Ø³ØªØºØ§Ù†Ù…", "Ø¨Ø´Ø§Ø±", "Ø§Ù„Ø´Ù„Ù", "Ø¹Ù†Ø§Ø¨Ø©", "ØªÙ…Ù†Ø±Ø§Ø³Øª"]
    };

    if (agencyBranches[agency]) {
      agencyBranches[agency].forEach(branch => {
        let opt = document.createElement("option");
        opt.value = branch;
        opt.textContent = branch;
        branchSelect.appendChild(opt);
      });
    }
  });

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª
  const wilayas = ["Ø£Ø¯Ø±Ø§Ø±","Ø§Ù„Ø´Ù„Ù","Ø§Ù„Ø£ØºÙˆØ§Ø·","Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ","Ø¨Ø§ØªÙ†Ø©","Ø¨Ø¬Ø§ÙŠØ©","Ø¨Ø³ÙƒØ±Ø©","Ø¨Ø´Ø§Ø±","Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©","Ø§Ù„Ø¨ÙˆÙŠØ±Ø©","ØªÙ…Ù†Ø±Ø§Ø³Øª","ØªØ¨Ø³Ø©","ØªÙ„Ù…Ø³Ø§Ù†","ØªÙŠØ§Ø±Øª","ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ","Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±","Ø§Ù„Ø¬Ù„ÙØ©","Ø¬ÙŠØ¬Ù„","Ø³Ø·ÙŠÙ","Ø³Ø¹ÙŠØ¯Ø©","Ø³ÙƒÙŠÙƒØ¯Ø©","Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³","Ø¹Ù†Ø§Ø¨Ø©","Ù‚Ø§Ù„Ù…Ø©","Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©","Ø§Ù„Ù…Ø¯ÙŠØ©","Ù…Ø³ØªØºØ§Ù†Ù…","Ø§Ù„Ù…Ø³ÙŠÙ„Ø©","Ù…Ø¹Ø³ÙƒØ±","ÙˆØ±Ù‚Ù„Ø©","ÙˆÙ‡Ø±Ø§Ù†","Ø§Ù„Ø¨ÙŠØ¶","Ø¥Ù„ÙŠØ²ÙŠ","Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬","Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³","Ø§Ù„Ø·Ø§Ø±Ù","ØªÙ†Ø¯ÙˆÙ","ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª","Ø§Ù„ÙˆØ§Ø¯ÙŠ","Ø®Ù†Ø´Ù„Ø©","Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³","ØªÙŠØ¨Ø§Ø²Ø©","Ù…ÙŠÙ„Ø©","Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰","Ø§Ù„Ù†Ø¹Ø§Ù…Ø©","Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª","ØºØ±Ø¯Ø§ÙŠØ©","ØºÙ„ÙŠØ²Ø§Ù†","ØªÙ…ÙŠÙ…ÙˆÙ†","Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±","Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„","Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³","Ø¹ÙŠÙ† ØµØ§Ù„Ø­","Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…","ØªÙ‚Ø±Øª","Ø¬Ø§Ù†Øª","Ø§Ù„Ù…ØºÙŠØ±","Ø§Ù„Ù…Ù†ÙŠØ¹Ø©"];
  const wilayaSelect = document.getElementById("wilaya");
  wilayas.forEach(w => {
    let opt = document.createElement("option");
    opt.value = w;
    opt.textContent = w;
    wilayaSelect.appendChild(opt);
  });

  // Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø§ÙÙ‚ØŒ Ø¥Ø±Ø³Ø§Ù„ØŒ ... (Ø¨Ø§Ù‚ÙŠ Ø³ÙƒØ±Ø¨ØªÙƒ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)

    // Ø¹Ø±Ø¶ Ø§Ù„ÙØ±ÙˆØ¹ Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø©
    const agencyBranches = {
      "ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø³Ù‚ÙŠÙØ© Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±": ["Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©", "Ø¬ÙŠØ¬Ù„", "Ø¹Ù†Ø§Ø¨Ø©", "Ø³ÙƒÙŠÙƒØ¯Ø©", "Ø³ÙˆÙ‚ Ø§Ù‡Ø±Ø§Ø³", "Ù…ÙŠÙ„Ø©"],
      "ÙˆÙƒØ§Ù„Ø© ØªÙ‚Ø±Øª Ù„Ù„Ø³ÙŠØ§Ø­Ø© Ùˆ Ø³ÙØ±": ["ØªÙ‚Ø±Øª", "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³", "Ø§Ù„Ù…ØºÙŠØ±", "Ø§Ù„Ø¬Ù„ÙØ©", "Ø§Ù„Ù…Ø¯ÙŠØ©", "Ù…Ø³ØªØºØ§Ù†Ù…", "Ø¨Ø´Ø§Ø±", "Ø§Ù„Ø´Ù„Ù", "Ø¹Ù†Ø§Ø¨Ø©", "ØªÙ…Ù†Ø±Ø§Ø³Øª"]
    };

    const branchSelect = document.getElementById("branch");
    if (agency && agencyBranches[agency]) {
      agencyBranches[agency].forEach(branch => {
        let opt = document.createElement("option");
        opt.value = branch;
        opt.textContent = branch;
        branchSelect.appendChild(opt);
      });
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø§ÙÙ‚
    let companionCount = 0;
    function addCompanion() {
      companionCount++;
      const container = document.getElementById("companionsContainer");
      const div = document.createElement("div");
      div.innerHTML = `
        <fieldset style="margin:10px 0;padding:10px;border:1px solid #ccc;">
          <legend>Ø§Ù„Ù…Ø±Ø§ÙÙ‚ ${companionCount}</legend>
          <label>Ø§Ù„ØµÙØ©:</label>
          <select name="companionRelation${companionCount}" required>
            <option value="">Ø§Ø®ØªØ±</option>
            <option value="Ø²ÙˆØ¬Ø©">Ø²ÙˆØ¬Ø©</option>
            <option value="Ø§Ø¨Ù†">Ø§Ø¨Ù†</option>
            <option value="Ø§Ø¨Ù†Ø©">Ø§Ø¨Ù†Ø©</option>
            <option value="Ø£Ø®">Ø£Ø®</option>
            <option value="Ø£Ø®Øª">Ø£Ø®Øª</option>
            <option value="Ø£Ù…">Ø£Ù…</option>
            <option value="Ø£Ø¨">Ø£Ø¨</option>
          </select>
          <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
          <input type="text" name="companionName${companionCount}" required>
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
          <input type="date" name="companionBirth${companionCount}" required>
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆØ§Ø²:</label>
          <input type="date" name="companionPassport${companionCount}" required>
          <button type="button" class="remove-companion-btn" onclick="this.parentElement.remove()">ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø©</button>
        </fieldset>
      `;
      container.appendChild(div);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById("umrahForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙÙ‚ÙŠÙ†
      const companions = [];
      document.querySelectorAll("#companionsContainer fieldset").forEach((fieldset, i) => {
        const relation = fieldset.querySelector(`select[name="companionRelation${i+1}"]`)?.value || "";
        const name = fieldset.querySelector(`input[name="companionName${i+1}"]`)?.value || "";
        const birth = fieldset.querySelector(`input[name="companionBirth${i+1}"]`)?.value || "";
        const passport = fieldset.querySelector(`input[name="companionPassport${i+1}"]`)?.value || "";
        if (name) companions.push(`${relation}: ${name} - Ù…ÙŠÙ„Ø§Ø¯: ${birth} - Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¬ÙˆØ§Ø²: ${passport}`);
      });

      formData.append("companions", companions.join(" | "));

      document.getElementById("message").style.display = "block";
      form.style.display = "none";

      fetch("https://script.google.com/macros/s/AKfycbwzPE5BMBiOx5x9RNzFozijomTvUcgAzaWTo39Pc7e8Zb7ZU7Zq6Df3k6iWC0oz5O7lyg/exec", {
        method: "POST",
        body: formData
      })
      .then(res => res.text())
      .then(res => {
        let counter = 10;
        const countdownElem = document.getElementById("countdown");
        const interval = setInterval(() => {
          counter--;
          countdownElem.textContent = counter;
          if (counter === 0) {
            clearInterval(interval);
            alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById("message").style.display = "none";
            document.getElementById("passportChoice").style.display = "block";
          }
        }, 1000);
      })
      .catch(err => {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
        form.style.display = "block";
        document.getElementById("message").style.display = "none";
      });
    });

    function toggleCompanionSection() {
      const type = document.getElementById("reservationType").value;
      const companionsDiv = document.getElementById("companionsSection");
      companionsDiv.style.display = (type === "Ù…Ù†ÙØ±Ø¯") ? "none" : "block";
    }
  </script>
</body>
</html>
