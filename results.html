<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Tajawal,Arial;
  background:#f5f5f5;
  margin:0;
}
.container{
  max-width:600px;
  background:#fff;
  margin:20px auto;
  padding:20px;
  border-radius:12px;
}
h2{text-align:center;color:#8b0000}
button,input{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:#8b0000;
  color:#fff;
  cursor:pointer;
}
.offer-card{
  background:#fafafa;
  margin-top:15px;
  padding:15px;
  border-radius:10px;
  border:1px solid #eee;
}
.offer-card h3{
  margin:0;
  color:#8b0000;
}
.offer-card p{
  margin:6px 0;
}

#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:2000;
}
#modalBox{
  background:#fff;
  max-width:420px;
  margin:10% auto;
  padding:20px;
  border-radius:12px;
}

/* Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ */
.whatsapp-top{
  position:fixed;
  top:15px;
  left:15px;
  width:55px;
  height:55px;
  background:#25D366;
  color:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  text-decoration:none;
  z-index:10000;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
}
</style>
</head>

<body>

<!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ -->
<a href="https://wa.me/213674141379" target="_blank" class="whatsapp-top">
  <i class="fab fa-whatsapp"></i>
</a>

<div class="container">
  <h2>ğŸ•‹ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h2>
  <div id="offers">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶...</div>
</div>

<!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="modal">
  <div id="modalBox">
    <h3 id="m_offer"></h3>
    <p id="m_agency"></p>
    <p id="m_date"></p>
    <p id="m_flight"></p>
    <p id="m_airport"></p>
    <p id="m_hotel"></p>
    <p id="m_prices"></p>

    <hr>

    <input id="c_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <input id="c_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input id="c_email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">

    <button onclick="sendOrder()">âœ… Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</button>
    <button onclick="closeModal()" style="background:#777">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
const OFFERS_API =
"https://script.google.com/macros/s/AKfycbx-Q6L4AHvlTXoSuU61aX_ndXT-WdLvWQ9TlCSRF-0P2DiBI5GlnX8UOcGOVFxSyn_lOQ/exec";

const EMAIL_API =
"https://script.google.com/macros/s/AKfycbzcxJ2mvd-Nnr5mdzPItK6_3pWnX3kR_EIQuKZanjW93RGIh06d4PDqcdWwMV0AyiVB/exec";

let offersData = [];
let selectedOffer = null;

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
function formatDate(d){
  return new Date(d).toLocaleDateString("ar-DZ",{
    day:"2-digit",
    month:"long",
    year:"numeric"
  });
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶
function loadOffers(){
  fetch(OFFERS_API)
    .then(res => res.json())
    .then(data => {
      offersData = data;
      const box = document.getElementById("offers");
      box.innerHTML = "";

      if(!data.length){
        box.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹";
        return;
      }

      data.forEach((o, i) => {
        box.innerHTML += `
          <div class="offer-card">
            <h3>${o.offer}</h3>
            <p>ğŸ¢ ${o.agency}</p>
            <p>ğŸ“… ${formatDate(o.date)}</p>
            <button onclick="openModal(${i})">
              ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
            </button>
          </div>`;
      });
    })
    .catch(()=>{
      document.getElementById("offers").innerText =
        "âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶";
    });
}

// ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
function openModal(index){
  const o = offersData[index];
  selectedOffer = o;

  document.getElementById("m_offer").innerText = o.offer;
  document.getElementById("m_agency").innerText = "ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: " + o.agency;
  document.getElementById("m_date").innerText = "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø­Ù„Ø©: " + formatDate(o.date);
  document.getElementById("m_flight").innerText = "âœˆï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©: " + o.flight;
  document.getElementById("m_airport").innerText = "ğŸ›« Ù…Ø·Ø§Ø± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹: " + o.airport;
  document.getElementById("m_hotel").innerText = "ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚: " + o.hotel;

  document.getElementById("m_prices").innerHTML =
    `ğŸ’° Ø¬Ù…Ø§Ø¹ÙŠØ©: ${o.group||"-"}<br>
     Ø®Ù…Ø§Ø³ÙŠØ©: ${o.five||"-"}<br>
     Ø±Ø¨Ø§Ø¹ÙŠØ©: ${o.four||"-"}<br>
     Ø«Ù„Ø§Ø«ÙŠØ©: ${o.three||"-"}<br>
     Ø«Ù†Ø§Ø¦ÙŠØ©: ${o.two||"-"}`;

  document.getElementById("modal").style.display = "block";
}

function closeModal(){
  document.getElementById("modal").style.display = "none";
}

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
function sendOrder(){
  if(!c_name.value || !c_phone.value){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
    return;
  }

  fetch(https://script.google.com/macros/s/AKfycbwGGY2hmbnllk2_I-mAb7kLelzjxl0X9RxIW0RRC-bk0nb7lwt-t1mEY_nWy0E9UgeH/exec,{
    method:"POST",
    body: JSON.stringify({
      customer:{
        name: c_name.value,
        phone: c_phone.value,
        email: c_email.value
      },
      offer: selectedOffer
    })
  })
  .then(()=>{
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­");
    c_name.value = c_phone.value = c_email.value = "";
    closeModal();
  })
  .catch(()=>{
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
  });
}

// ØªØ´ØºÙŠÙ„
loadOffers();
</script>

</body>
</html>
