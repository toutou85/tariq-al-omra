<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</title>

<style>
body{
  font-family:Tajawal,Arial;
  background:#f5f5f5;
  margin:0;
}
.container{
  max-width:700px;
  background:#fff;
  margin:20px auto;
  padding:20px;
  border-radius:12px;
}
h2{text-align:center;color:#8b0000}
input,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:#8b0000;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
.card{
  background:#fafafa;
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}
.card h3{margin:0;color:#8b0000}
.card p{margin:6px 0}

/* Modal */
#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
}
#modalBox{
  background:#fff;
  margin:10% auto;
  padding:20px;
  max-width:400px;
  border-radius:12px;
}
</style>
</head>

<body>

<div class="container">
  <h2>ğŸ•‹ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h2>

  <p style="color:#555;text-align:center">
    ÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ùƒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙØ§Ø±ØºÙ‹Ø§ Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶  
    Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„Ù‡ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªÙŠ Ø§Ø®ØªØ±ØªÙ‡Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§
  </p>

  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <button onclick="search()">ğŸ” Ø¨Ø­Ø«</button>

  <div id="offers"></div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
<div id="modal">
  <div id="modalBox">
    <div id="modalContent"></div>
    <button onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
// ğŸ”— Ø±Ø§Ø¨Ø· Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø±ÙŠÙ†
const ORDERS_API =
"https://script.google.com/macros/s/AKfycbxMbVj_Fb7Gam2LPFOgAUpmuhy7jV9RKT_wBSVjGJ1LWyHYc_VqBoIkZZYHFEPdUY9CpA/exec";

// ğŸ”— Ø±Ø§Ø¨Ø· Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª
const OFFERS_API =
"https://script.google.com/macros/s/AKfycbyjoK1PBB91jup0o2Gh3zWY8eyFOV_Uld6zofeJAWyiTZiOGTY5MCFFUemhg7IVu2xrjQ/exec";

// ğŸ” ØªÙˆØ­ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
function normalizePhone(p){
  p = p.replace(/\D/g,'');
  if(p.startsWith('213')) p = p.substring(3);
  if(p.startsWith('0')) p = p.substring(1);
  return p;
}

// ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ (Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
function loadAllOffers(){
  fetch(OFFERS_API)
  .then(r=>r.json())
  .then(showOffers);
}

// ğŸ”µ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹ØªÙ…Ø±
function loadUserOffers(phone){

  fetch(ORDERS_API + "?phone=" + phone)
  .then(r=>r.json())
  .then(orderData=>{

    if(!orderData.found){
      document.getElementById("offers").innerHTML =
        "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…";
      return;
    }

    fetch(OFFERS_API)
    .then(r=>r.json())
    .then(offers=>{
      const matched = offers.filter(o =>
        o.agency == orderData.agency &&
        o.offer  == orderData.offer &&
        o.date   == orderData.date
      );
      showOffers(matched);
    });

  });
}

// ğŸ§± Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
function showOffers(data){
  const box = document.getElementById("offers");
  box.innerHTML = "";

  if(!data || data.length === 0){
    box.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…ØªÙˆÙØ±Ø©";
    return;
  }

  data.forEach(o=>{
    box.innerHTML += `
      <div class="card">
        <h3>${o.offer}</h3>
        <p>ğŸ¢ ${o.agency}</p>
        <p>ğŸ“… ${o.date}</p>
        <p>ğŸ’° ØºØ±ÙØ© Ø¬Ù…Ø§Ø¹ÙŠØ©: ${o.group}</p>
        <button onclick='showDetails(${JSON.stringify(o)})'>
          ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
        </button>
      </div>
    `;
  });
}

// ğŸ” Ø²Ø± Ø§Ù„Ø¨Ø­Ø«
function search(){
  const phone = normalizePhone(
    document.getElementById("phone").value
  );

  if(phone){
    loadUserOffers(phone);
  }else{
    loadAllOffers();
  }
}

// ğŸªŸ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
function showDetails(o){
  document.getElementById("modalContent").innerHTML = `
    <p><strong>ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:</strong> ${o.agency}</p>
    <p><strong>ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚:</strong> ${o.hotel}</p>
    <p><strong>âœˆï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©:</strong> ${o.flight}</p>
    <p><strong>ğŸ›« Ù…Ø·Ø§Ø± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹:</strong> ${o.airport}</p>
    <p>ğŸ’° Ø®Ù…Ø§Ø³ÙŠØ©: ${o.five}</p>
    <p>ğŸ’° Ø±Ø¨Ø§Ø¹ÙŠØ©: ${o.four}</p>
    <p>ğŸ’° Ø«Ù„Ø§Ø«ÙŠØ©: ${o.three}</p>
    <p>ğŸ’° Ø«Ù†Ø§Ø¦ÙŠØ©: ${o.two}</p>
  `;
  document.getElementById("modal").style.display="block";
}
function closeModal(){
  document.getElementById("modal").style.display="none";
}

// ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
loadAllOffers();
</script>

</body>
</html>