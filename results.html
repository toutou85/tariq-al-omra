<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Tajawal,Arial;
  background:#f5f5f5;
  margin:0;
}
.container{
  max-width:600px;
  background:#fff;
  margin:20px auto;
  padding:20px;
  border-radius:12px;
}
h2{text-align:center;color:#8b0000}

.offer-card{
  background:#fafafa;
  margin-top:15px;
  padding:15px;
  border-radius:10px;
  border:1px solid #eee;
}
.offer-card h3{margin:0;color:#8b0000}
.offer-card p{margin:6px 0}

button,input{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:#8b0000;
  color:#fff;
  cursor:pointer;
}

/* Modal */
#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:9999;
}
#modalBox{
  background:#fff;
  max-width:420px;
  margin:10% auto;
  padding:20px;
  border-radius:12px;
  max-height:80vh;
  overflow:auto;
}

/* WhatsApp */
.whatsapp-top{
  position:fixed;
  top:15px;
  left:15px;
  width:55px;
  height:55px;
  background:#25D366;
  color:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  z-index:10000;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
}
</style>
</head>

<body>

<!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ -->
<a href="https://wa.me/213674141379" target="_blank" class="whatsapp-top">
  <i class="fab fa-whatsapp"></i>
</a>

<div class="container">
  <h2>ğŸ•‹ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h2>
  <div id="offers">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶...</div>
</div>

<!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="modal">
  <div id="modalBox">
    <h3 id="m_offer"></h3>
    <p id="m_agency"></p>
    <p id="m_date"></p>
    <p id="m_flight"></p>
    <p id="m_airport"></p>
    <p id="m_hotel"></p>
    <p id="m_prices"></p>

    <hr>

    <input id="c_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <input id="c_phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input id="c_email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">

    <button id="sendBtn">âœ… Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</button>
    <button id="closeBtn" style="background:#777">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
  // ğŸ”— Ø±Ø§Ø¨Ø· Google Apps Script (Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø±ÙŠÙ†) const apiURL = "https://script.google.com/macros/s/AKfycbxMbVj_Fb7Gam2LPFOgAUpmuhy7jV9RKT_wBSVjGJ1LWyHYc_VqBoIkZZYHFEPdUY9CpA/exec"; // ğŸ”— Ø±Ø§Ø¨Ø· Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª const OFFERS_API = "https://script.google.com/macros/s/AKfycbx-Q6L4AHvlTXoSuU61aX_ndXT-WdLvWQ9TlCSRF-0P2DiBI5GlnX8UOcGOVFxSyn_lOQ/exec"; // ğŸ” ØªÙˆØ­ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ function normalizePhone(phone){ phone = phone.replace(/\D/g,""); if(phone.startsWith("213")) phone = phone.substring(3); if(phone.startsWith("0")) phone = phone.substring(1); return phone; } // ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (ÙƒÙ…Ø§ Ù‡Ùˆ) function search(){ const phoneInput = document.getElementById("phone").value; const phone = normalizePhone(phoneInput); const output = document.getElementById("output"); if(!phone){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"); return; } output.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«..."; fetch(apiURL + "?phone=" + phone) .then(res => res.json()) .then(data => { if(!data.found){ output.innerHTML = <div class="result"> âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… </div>; return; } output.innerHTML = <div class="result"> <p>ğŸ‘¤ <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${data.name}</p> <p>ğŸ“Œ <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</strong> <span class="status">${data.status}</span> </p> <div class="note"> â³ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙƒÙ… Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ </div> </div> ; }) .catch(() => { output.innerHTML = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…"; }); }
// ========= Ø±ÙˆØ§Ø¨Ø·Ùƒ =========

const EMAIL_API =
"https://script.google.com/macros/s/AKfycbzcxJ2mvd-Nnr5mdzPItK6_3pWnX3kR_EIQuKZanjW93RGIh06d4PDqcdWwMV0AyiVB/exec";

// ========= Ù…ØªØºÙŠØ±Ø§Øª =========
let offersData = [];
let selectedOffer = null;

// ========= Ø£Ø¯ÙˆØ§Øª =========
function formatDate(d){
  return new Date(d).toLocaleDateString("ar-DZ",{
    day:"2-digit",
    month:"long",
    year:"numeric"
  });
}

// ========= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ =========
fetch(OFFERS_API)
.then(res => res.json())
.then(data=>{
  offersData = data;
  const box = document.getElementById("offers");
  box.innerHTML = "";

  if(!data.length){
    box.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹";
    return;
  }

  data.forEach((o, i)=>{
    const card = document.createElement("div");
    card.className = "offer-card";
    card.innerHTML = `
      <h3>${o.offer}</h3>
      <p>ğŸ¢ ${o.agency}</p>
      <p>ğŸ“… ${formatDate(o.date)}</p>
      <button>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶</button>
    `;
    card.querySelector("button").addEventListener("click",()=>{
      openModal(i);
    });
    box.appendChild(card);
  });
})
.catch(()=>{
  document.getElementById("offers").innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶";
});

// ========= ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© =========
function openModal(index){
  const o = offersData[index];
  selectedOffer = o;

  document.getElementById("m_offer").innerText   = o.offer;
  document.getElementById("m_agency").innerText = "ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: " + o.agency;
  document.getElementById("m_date").innerText   = "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø­Ù„Ø©: " + formatDate(o.date);
  document.getElementById("m_flight").innerText = "âœˆï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©: " + o.flight;
  document.getElementById("m_airport").innerText= "ğŸ›« Ù…Ø·Ø§Ø± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹: " + o.airport;
  document.getElementById("m_hotel").innerText  = "ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚: " + o.hotel;

  document.getElementById("m_prices").innerHTML =
    `ğŸ’° Ø¬Ù…Ø§Ø¹ÙŠØ©: ${o.group||"-"}<br>
     Ø®Ù…Ø§Ø³ÙŠØ©: ${o.five||"-"}<br>
     Ø±Ø¨Ø§Ø¹ÙŠØ©: ${o.four||"-"}<br>
     Ø«Ù„Ø§Ø«ÙŠØ©: ${o.three||"-"}<br>
     Ø«Ù†Ø§Ø¦ÙŠØ©: ${o.two||"-"}`;

  document.getElementById("modal").style.display = "block";
}

// ========= Ø¥ØºÙ„Ø§Ù‚ =========
document.getElementById("closeBtn").onclick = ()=>{
  document.getElementById("modal").style.display = "none";
};

// ========= Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ =========
document.getElementById("sendBtn").onclick = ()=>{
  const name  = c_name.value.trim();
  const phone = c_phone.value.trim();
  const email = c_email.value.trim();

  if(!name || !phone){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
    return;
  }

  document.getElementById("sendBtn").disabled = true;
  document.getElementById("sendBtn").innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  fetch(EMAIL_API,{
    method:"POST",
    body: JSON.stringify({
      customer:{ name, phone, email },
      offer: selectedOffer
    })
  })
  .then(()=>{
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­");
    c_name.value = c_phone.value = c_email.value = "";
    document.getElementById("modal").style.display = "none";
  })
  .catch(()=>{
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
  })
  .finally(()=>{
    document.getElementById("sendBtn").disabled = false;
    document.getElementById("sendBtn").innerText = "âœ… Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†";
  });
};
</script>

</body>
</html>
