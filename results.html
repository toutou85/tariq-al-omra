<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</title>

<style>
body{font-family:Tajawal;background:#f5f5f5;margin:0}
.container{max-width:700px;margin:20px auto;background:#fff;padding:20px;border-radius:12px}
.card{background:#fafafa;padding:15px;border-radius:10px;margin-top:15px}
.card h3{margin:0;color:#8b0000}
button{width:100%;padding:10px;border:none;border-radius:8px;background:#8b0000;color:#fff;cursor:pointer}
#modal{display:none;position:fixed;inset:0;background:#0008}
#modalBox{background:#fff;margin:10% auto;padding:20px;max-width:400px;border-radius:12px}
</style>
</head>

<body>

<div class="container">
  <h2 style="text-align:center;color:#8b0000">ğŸ•‹ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</h2>

  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <button onclick="search()">ğŸ” Ø¨Ø­Ø«</button>

  <div id="offers">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶...</div>
</div>

<div id="modal">
  <div id="modalBox">
    <div id="modalContent"></div>
    <button onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
const ORDERS_API =
"https://script.google.com/macros/s/AKfycbxMbVj_Fb7Gam2LPFOgAUpmuhy7jV9RKT_wBSVjGJ1LWyHYc_VqBoIkZZYHFEPdUY9CpA/exec";

const OFFERS_API =
"https://script.google.com/macros/s/AKfycbyjoK1PBB91jup0o2Gh3zWY8eyFOV_Uld6zofeJAWyiTZiOGTY5MCFFUemhg7IVu2xrjQ/exec";

function normalizePhone(p){
  return p.replace(/\D/g,'').replace(/^213/,'').replace(/^0/,'');
}

// ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶
function loadAllOffers(){
  fetch(OFFERS_API)
  .then(r=>r.json())
  .then(data=>{
    if(!Array.isArray(data)){
      document.getElementById("offers").innerHTML="âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±ÙˆØ¶";
      return;
    }
    showOffers(data);
  })
  .catch(()=>{
    document.getElementById("offers").innerHTML="âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶";
  });
}

// ğŸ”µ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
function search(){
  const phone = normalizePhone(document.getElementById("phone").value);

  if(!phone){
    loadAllOffers();
    return;
  }

  fetch(ORDERS_API + "?phone=" + phone)
  .then(r=>r.json())
  .then(order=>{
    if(!order.found){
      document.getElementById("offers").innerHTML="âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…";
      return;
    }

    fetch(OFFERS_API)
    .then(r=>r.json())
    .then(offers=>{
      const filtered = offers.filter(o =>
        o.agency == order.agency &&
        o.offer  == order.offer &&
        o.date   == order.date
      );
      showOffers(filtered);
    });
  })
  .catch(()=>{
    document.getElementById("offers").innerHTML="âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«";
  });
}

// ğŸ§± Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
function showOffers(list){
  const box = document.getElementById("offers");
  box.innerHTML="";

  if(list.length===0){
    box.innerHTML="âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…Ø·Ø§Ø¨Ù‚Ø©";
    return;
  }

  list.forEach(o=>{
    box.innerHTML+=`
      <div class="card">
        <h3>${o.offer}</h3>
        <p>ğŸ¢ ${o.agency}</p>
        <p>ğŸ“… ${o.date}</p>
        <p>ğŸ’° Ø¬Ù…Ø§Ø¹ÙŠØ©: ${o.group || "-"}</p>
        <button onclick='showDetails(${JSON.stringify(o)})'>
          ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
        </button>
      </div>
    `;
  });
}

// ğŸªŸ Ø§Ù„ØªÙØ§ØµÙŠÙ„
function showDetails(o){
  document.getElementById("modalContent").innerHTML=`
    <p>ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚: ${o.hotel}</p>
    <p>âœˆï¸ Ø§Ù„Ø±Ø­Ù„Ø©: ${o.flight}</p>
    <p>ğŸ›« Ø§Ù„Ù…Ø·Ø§Ø±: ${o.airport}</p>
    <p>ğŸ’° Ø®Ù…Ø§Ø³ÙŠØ©: ${o.five}</p>
    <p>ğŸ’° Ø±Ø¨Ø§Ø¹ÙŠØ©: ${o.four}</p>
    <p>ğŸ’° Ø«Ù„Ø§Ø«ÙŠØ©: ${o.three}</p>
    <p>ğŸ’° Ø«Ù†Ø§Ø¦ÙŠØ©: ${o.two}</p>
  `;
  document.getElementById("modal").style.display="block";
}
function closeModal(){
  document.getElementById("modal").style.display="none";
}

// ğŸš€ ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
loadAllOffers();
</script>

</body>
</html>