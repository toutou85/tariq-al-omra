<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª</title>

<style>
body{
  font-family:Arial;
  background:#f2f2f2;
  padding:20px;
}
.card{
  background:#fff;
  padding:15px;
  margin-bottom:10px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
button{
  background:#25D366;
  color:#fff;
  border:none;
  padding:10px 15px;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª</h2>

<div id="list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

<script>
// ğŸ”¹ API Ø§Ù„Ø°ÙŠ ÙŠØ¬Ù„Ø¨ Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª Ù…Ù† Google Sheets
const OFFERS_API =
"https://script.google.com/macros/s/AKfycbwN-Mgn61HDqdCD2_shOx3nRAcW-O8GxquhSpxaSX0Az00W1W_48lVFCowDqF41ZN_7dQ/exec";

// ğŸ”¹ API ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Google Sheets)
const LOG_API =
"https://script.google.com/macros/s/AKfycbzvVAO9qu-bwwJxg9jOJZyzwhRQdZf-FcJCZ0Uw1FcvqFD25JT978PPerBo7EuCk2_L/exec";

fetch(OFFERS_API)
.then(r => r.json())
.then(data => render(data));

function render(data){
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(o => {

    // Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† Ø§Ù„Ø´ÙŠØª
    let phone = String(o.phone || "").replace(/\D/g,"");
    if(!phone) return;

    if(!phone.startsWith("213")){
      phone = "213" + phone;
    }

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <div><strong>ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:</strong> ${o.agency}</div>
      <div><strong>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone}</div>
      <br>
      <button onclick="sendWhatsApp('${phone}','${o.agency}')">
        ğŸ“² ÙˆØ§ØªØ³Ø§Ø¨
      </button>
    `;

    list.appendChild(div);
  });
}

function sendWhatsApp(phone, agency){

  const message = `
Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ğŸŒ¿
Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙˆÙƒØ§Ù„Ø© ${agency}
Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ø±Ø© ğŸ•‹
`;

  // 1ï¸âƒ£ ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨
  window.open(
    "https://wa.me/" + phone + "?text=" + encodeURIComponent(message),
    "_blank"
  );

  // 2ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Google Sheets
  fetch(LOG_API,{
    method:"POST",
    body:JSON.stringify({
      agency: agency,
      phone: phone,
      time: new Date().toLocaleString("ar-DZ")
    })
  });
}
</script>

</body>
</html>

