<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Tajawal,Arial;
  margin:0;
  background:
    linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.45)),
    url("https://i.supaimg.com/c5d71aa9-c2b3-4263-8bd6-2f800145c063.jpg")
    center/cover fixed no-repeat;
}
header{
  height:60px;
  background:#8b0000;
  color:#fff;
  display:flex;
  align-items:center;
  padding:0 15px;
}
header h1{
  flex:1;
  text-align:center;
  font-size:18px;
  margin:0;
}

.container{
  max-width:520px;
  background:rgba(255,255,255,.93);
  margin:30px auto;
  padding:25px;
  border-radius:18px;
  text-align:center;
}

input,button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  background:#8b0000;
  color:#fff;
  cursor:pointer;
}

.welcome{
  margin-top:20px;
  background:#f8f4ef;
  padding:18px;
  border-radius:14px;
  text-align:right;
}

.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:15px;
}
.actions button{background:#444}
.actions .primary{background:#8b0000}

#popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:12000;
  align-items:center;
  justify-content:center;
}
#popupBox{
  background:#fff;
  padding:25px;
  border-radius:14px;
}
</style>
</head>

<body>

<header>
  <h1>ğŸ‘¤ ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</h1>
</header>

<div class="container">
  <h2>Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ØµÙØ­ØªÙƒ</h2>
  <input type="tel" id="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <button onclick="check()">ğŸ” Ù…ØªØ§Ø¨Ø¹Ø©</button>
  <div id="result"></div>
</div>

<div id="popup">
  <div id="popupBox">
    <h3>â³ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
    <p>Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… ğŸ¤</p>
  </div>
</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbwaPdiqpKXpPc1_GIoVo5WV98ecIK-ay2QcQzVRqrVfezFuL-vGIziHuEJVG9TtrhAQCw/exec";

const phoneInput = document.getElementById("phone");
const result = document.getElementById("result");
const popup = document.getElementById("popup");

function normalize(p){
  p = p.replace(/\D/g,"");
  if(p.startsWith("213")) p = p.slice(3);
  if(p.startsWith("0")) p = p.slice(1);
  return p;
}

function formatDate(d){
  if(!d) return "-";
  return new Date(d).toLocaleDateString("ar-DZ");
}

function check(){
  const phone = normalize(phoneInput.value);
  if(!phone){
    alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
    return;
  }

  popup.style.display = "flex";

  fetch(API + "?phone=" + phone)
  .then(r => r.json())
  .then(d => {

    popup.style.display = "none";
    console.log("API DATA:", d);

    /* Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØµØ­ÙŠØ­ */
    if(!d || d.found !== true){
      result.innerHTML = "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…";
      return;
    }

    /* Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© */
    localStorage.setItem("umrah_phone", phone);

    result.innerHTML = `
      <div class="welcome">
        <p>ğŸŒ™ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ <strong>${d.name || ""} ${d.lastname || ""}</strong></p>
        <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${d.phone || "-"}</p>
        <p>âœˆï¸ Ø§Ù„Ù…Ø·Ø§Ø±: ${d.airport || "-"}</p>
        <p>ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚: ${d.hotel || "-"}</p>
        <p>â³ Ø§Ù„Ù…Ø¯Ø©: ${d.duration || "-"}</p>
        <p>ğŸ›ï¸ Ø§Ù„ØºØ±ÙØ©: ${d.room || "-"}</p>
        <p>ğŸ—ºï¸ Ø§Ù„Ù…Ø³Ø§Ø±: ${d.route || "-"}</p>
        <p>ğŸ›« Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©: ${d.flight || "-"}</p>
        <p>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: ${d.residence || "-"}</p>
        <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚: ${formatDate(d.travel_date)}</p>

        <div class="actions">
          <button class="primary"
            onclick="location.href='results-n.html'">
            â­ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
          </button>
          <button
            onclick="location.href='results-gen.html'">
            ğŸ“‹ ÙƒÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶
          </button>
        </div>
      </div>
    `;
  })
  .catch(err=>{
    popup.style.display="none";
    result.innerHTML="âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
    console.error(err);
  });
}
</script>

</body>
</html>
