<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</title>

<style>
body{font-family:Tajawal,Arial;margin:0;background:#f2f2f2}
header{background:#8b0000;color:#fff;padding:15px;text-align:center}
.container{max-width:600px;margin:25px auto;background:#fff;padding:25px;border-radius:18px}

.field{margin-bottom:10px}
.field label{font-size:13px;color:#555}
.field input, .field textarea{
  width:100%;padding:10px;border-radius:10px;border:1px solid #ccc
}
input[disabled], textarea[disabled]{background:#eee}

button{
  width:100%;padding:12px;margin-top:10px;
  border:none;border-radius:10px;cursor:pointer
}
.edit{background:#555;color:#fff}
.save{background:#8b0000;color:#fff}
.go{background:#00695c;color:#fff}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */
#wait{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;justify-content:center;
}
#waitBox{
  background:#fff;padding:25px;border-radius:14px;
  text-align:center
}
</style>
</head>

<body>

<header><h2>ğŸ‘¤ ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</h2></header>

<div class="container">

<div id="loginBox">
  <input id="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <button class="save" onclick="loadUser()">ğŸ” Ù…ØªØ§Ø¨Ø¹Ø©</button>
</div>

<div id="userBox" style="display:none">

  <div id="welcome" style="margin-bottom:15px;font-weight:700"></div>

  <input type="hidden" id="row">

  <div class="field"><label>Ø§Ù„Ø§Ø³Ù…</label><input id="name" disabled></div>
  <div class="field"><label>Ø§Ù„Ù„Ù‚Ø¨</label><input id="lastname" disabled></div>
  <div class="field"><label>Ø§Ù„Ù‡Ø§ØªÙ</label><input id="phone2" disabled></div>
  <div class="field"><label>Ù…Ø·Ø§Ø± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹</label><input id="airport" disabled></div>
  <div class="field"><label>Ø§Ù„ÙÙ†Ø¯Ù‚</label><input id="hotel" disabled></div>
  <div class="field"><label>Ø§Ù„Ù…Ø¯Ø©</label><input id="duration" disabled></div>
  <div class="field"><label>Ø§Ù„ØºØ±ÙØ©</label><input id="room" disabled></div>
  <div class="field"><label>Ø§Ù„Ù…Ø³Ø§Ø±</label><input id="route" disabled></div>
  <div class="field"><label>Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©</label><input id="flight" disabled></div>
  <div class="field"><label>Ù…Ù„Ø§Ø­Ø¸Ø©</label><textarea id="note" disabled></textarea></div>
  <div class="field"><label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label><input id="residence" disabled></div>
  <div class="field"><label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹</label><input type="date" id="travel_date" disabled></div>

  <button class="edit" onclick="enableEdit()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
  <button class="save" id="saveBtn" onclick="saveEdit()" style="display:none">
    ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
  </button>

  <button class="go" onclick="location.href='results.html'">
    â­ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
  </button>

</div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù†ØªØ¸Ø§Ø± -->
<div id="wait">
  <div id="waitBox">
    â³ Ø¬Ø§Ø±Ù Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øªâ€¦<br>
    ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  </div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwaPdiqpKXpPc1_GIoVo5WV98ecIK-ay2QcQzVRqrVfezFuL-vGIziHuEJVG9TtrhAQCw/exec";

function normalize(p){
  p=p.replace(/\D/g,"");
  if(p.startsWith("213"))p=p.slice(3);
  if(p.startsWith("0"))p=p.slice(1);
  return p;
}

function loadUser(){
  const p=normalize(phone.value);
  fetch(API+"?phone="+p)
  .then(r=>r.json())
  .then(d=>{
    if(!d.found) return alert("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨");

    loginBox.style.display="none";
    userBox.style.display="block";

    welcome.innerText="ğŸŒ™ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ "+d.name+" "+d.lastname;

    row.value=d.row;
    name.value=d.name;
    lastname.value=d.lastname;
    phone2.value=d.phone;
    airport.value=d.airport;
    hotel.value=d.hotel;
    duration.value=d.duration;
    room.value=d.room;
    route.value=d.route;
    flight.value=d.flight;
    note.value=d.note;
    residence.value=d.residence;
    travel_date.value=d.travel_date?.split("T")[0];
  });
}

function enableEdit(){
  document.querySelectorAll("#userBox input,textarea")
    .forEach(i=>i.disabled=false);
  saveBtn.style.display="block";
}

function saveEdit(){
  wait.style.display="flex";

  const data={
    update:1,
    row:row.value,
    name:name.value,
    lastname:lastname.value,
    airport:airport.value,
    hotel:hotel.value,
    duration:duration.value,
    room:room.value,
    route:route.value,
    flight:flight.value,
    note:note.value,
    residence:residence.value,
    travel_date:travel_date.value
  };

  fetch(API,{method:"POST",body:new URLSearchParams(data)})
  .then(()=> {
    wait.style.display="none";
    alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
    location.reload();
  });
}
</script>

</body>
</html>