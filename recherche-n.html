
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุตูุญุชู ุงูุฎุงุตุฉ</title>

<style>
body{font-family:Tajawal,Arial;margin:0;background:#f2f2f2}
header{background:#8b0000;color:#fff;padding:15px;text-align:center}
.container{max-width:600px;margin:25px auto;background:#fff;padding:25px;border-radius:18px}

.field{margin-bottom:10px}
.field label{font-size:13px;color:#555}
.field input,.field textarea,.field select{
  width:100%;padding:10px;border-radius:10px;border:1px solid #ccc
}
input[readonly],textarea[readonly],select:disabled{background:#eee}

button{
  width:100%;padding:12px;margin-top:10px;
  border:none;border-radius:10px;cursor:pointer
}
.edit{background:#555;color:#fff}
.save{background:#8b0000;color:#fff}
.go{background:#00695c;color:#fff}

#wait{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;justify-content:center;
}
#waitBox{
  background:#fff;padding:25px;border-radius:14px;
  text-align:center
}
</style>
</head>

<body>

<header><h2>๐ค ุตูุญุชู ุงูุฎุงุตุฉ</h2></header>

<div class="container">

<div id="loginBox">
  <input id="phone" placeholder="ุฃุฏุฎู ุฑูู ุงููุงุชู">
  <button class="save" onclick="loadUser()">๐ ูุชุงุจุนุฉ</button>
</div>

<div id="userBox" style="display:none">

  <div id="welcome" style="margin-bottom:15px;font-weight:700"></div>

  <input type="hidden" id="row">

  <div class="field"><label>ุงูุงุณู</label><input id="name" readonly></div>
  <div class="field"><label>ุงูููุจ</label><input id="lastname" readonly></div>
  <div class="field"><label>ุงููุงุชู</label><input id="phone2" readonly></div>
  <div class="field"><label>ูุทุงุฑ ุงูุฅููุงุน</label><input id="airport" readonly></div>
  <div class="field"><label>ุงูููุฏู</label><input id="hotel" readonly></div>
  <div class="field"><label>ุงููุฏุฉ</label><input id="duration" readonly></div>
  <div class="field"><label>ุงูุบุฑูุฉ</label><input id="room" readonly></div>
  <div class="field"><label>ุงููุณุงุฑ</label><input id="route" readonly></div>
  <div class="field"><label>ููุน ุงูุฑุญูุฉ</label><input id="flight" readonly></div>
  <div class="field"><label>ููุงุญุธุฉ</label><textarea id="note" readonly></textarea></div>

  <div class="field">
    <label>ุงูููุงูุฉ</label>
    <select id="residence" disabled>
      <option value="">ุงุฎุชุฑ ุงูููุงูุฉ</option>
      <option>ุฃุฏุฑุงุฑ</option><option>ุงูุดูู</option><option>ุงูุฃุบูุงุท</option>
      <option>ุฃู ุงูุจูุงูู</option><option>ุจุงุชูุฉ</option><option>ุจุฌุงูุฉ</option>
      <option>ุจุณูุฑุฉ</option><option>ุจุดุงุฑ</option><option>ุงูุจููุฏุฉ</option>
      <option>ุงูุจููุฑุฉ</option><option>ุชููุฑุงุณุช</option><option>ุชุจุณุฉ</option>
      <option>ุชููุณุงู</option><option>ุชูุงุฑุช</option><option>ุชูุฒู ูุฒู</option>
      <option>ุงูุฌุฒุงุฆุฑ</option><option>ุงูุฌููุฉ</option><option>ุฌูุฌู</option>
      <option>ุณุทูู</option><option>ุณุนูุฏุฉ</option><option>ุณูููุฏุฉ</option>
      <option>ุณูุฏู ุจูุนุจุงุณ</option><option>ุนูุงุจุฉ</option><option>ูุงููุฉ</option>
      <option>ูุณูุทููุฉ</option><option>ุงููุฏูุฉ</option><option>ูุณุชุบุงูู</option>
      <option>ุงููุณููุฉ</option><option>ูุนุณูุฑ</option><option>ูุฑููุฉ</option>
      <option>ููุฑุงู</option><option>ุงูุจูุถ</option><option>ุฅููุฒู</option>
      <option>ุจุฑุฌ ุจูุนุฑูุฑูุฌ</option><option>ุจููุฑุฏุงุณ</option><option>ุงูุทุงุฑู</option>
      <option>ุชูุฏูู</option><option>ุชูุณูุณููุช</option><option>ุงููุงุฏู</option>
      <option>ุฎูุดูุฉ</option><option>ุณูู ุฃูุฑุงุณ</option><option>ุชูุจุงุฒุฉ</option>
      <option>ูููุฉ</option><option>ุนูู ุงูุฏููู</option><option>ุงููุนุงูุฉ</option>
      <option>ุนูู ุชููุดูุช</option><option>ุบุฑุฏุงูุฉ</option><option>ุบููุฒุงู</option>
      <option>ุชูููููู</option><option>ุจุฑุฌ ุจุงุฌู ูุฎุชุงุฑ</option>
      <option>ุฃููุงุฏ ุฌูุงู</option><option>ุจูู ุนุจุงุณ</option>
      <option>ุนูู ุตุงูุญ</option><option>ุนูู ูุฒุงู</option>
      <option>ุชูุฑุช</option><option>ุฌุงูุช</option>
      <option>ุงููุบูุฑ</option><option>ุงููููุนุฉ</option>
    </select>
  </div>

  <div class="field">
    <label>ุชุงุฑูุฎ ุงูุฅููุงุน</label>
    <input type="date" id="travel_date" readonly>
  </div>

  <button class="edit" onclick="enableEdit()">โ๏ธ ุชุนุฏูู ุงููุนูููุงุช</button>
  <button class="save" id="saveBtn" onclick="saveEdit()" style="display:none">
    ๐พ ุญูุธ ุงูุชุนุฏููุงุช
  </button>

  <button class="go" onclick="location.href='results.html'">
    โญ ุงูุนุฑูุถ ุงูููุงุณุจุฉ
  </button>

</div>
</div>

<div id="wait">
  <div id="waitBox">
    โณ ุฌุงุฑู ุญูุธ ุงูุชุนุฏููุงุชโฆ<br>
    ูุฑุฌู ุงูุงูุชุธุงุฑ
  </div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwsZZ1jb1b-BIUviU2j2bpZ-Av7NGoB67bvAY2ZnFFM6kQ6nPcqFPZ7EWExDFGYqYTP/exec";

/* โ ุชูุญูุฏ ุฑูู ุงููุงุชู (9 ุฃุฑูุงู ููุท) */
function normalize(p){
  p=p.replace(/\D/g,"");

  if(p.startsWith("00213")) p=p.slice(5);
  else if(p.startsWith("213")) p=p.slice(3);

  if(p.startsWith("0")) p=p.slice(1);

  if(p.length!==9) return null;
  return p;
}

function loadUser(){
  const p=normalize(phone.value);
  if(!p){ alert("โ ุฑูู ุงููุงุชู ุบูุฑ ุตุญูุญ"); return; }

  fetch(API+"?phone="+p)
  .then(r=>r.json())
  .then(d=>{
    if(!d.found){ alert("โ ูุง ููุฌุฏ ุทูุจ"); return; }

    loginBox.style.display="none";
    userBox.style.display="block";

    welcome.innerText="๐ ูุฑุญุจูุง ุจู "+d.name+" "+d.lastname;

    row.value=d.row;
    name.value=d.name;
    lastname.value=d.lastname;
    phone2.value=d.phone;
    airport.value=d.airport;
    hotel.value=d.hotel;
    duration.value=d.duration;
    room.value=d.room;
    route.value=d.route;
    flight.value=d.flight;
    note.value=d.note;
    residence.value=d.residence;
    travel_date.value=d.travel_date?.split("T")[0];
  });
}

function enableEdit(){
  document.querySelectorAll("#userBox input,textarea,select")
  .forEach(i=>{
    i.readOnly=false;
    i.disabled=false;
  });
  saveBtn.style.display="block";
}

function saveEdit(){
  wait.style.display="flex";

  const data={
    update:1,
    row:row.value,
    name:name.value,
    lastname:lastname.value,
    airport:airport.value,
    hotel:hotel.value,
    duration:duration.value,
    room:room.value,
    route:route.value,
    flight:flight.value,
    note:note.value,
    residence:residence.value,
    travel_date:travel_date.value
  };

  fetch(API,{method:"POST",body:new URLSearchParams(data)})
  .then(()=> {
    wait.style.display="none";
    alert("โ ุชู ุชุณุฌูู ุงูุชุนุฏููุงุช ุจูุฌุงุญ");

    document.querySelectorAll("#userBox input,textarea,select")
    .forEach(i=>{
      i.readOnly=true;
      i.disabled=true;
    });

    saveBtn.style.display="none";
  })
  .catch(()=>{
    wait.style.display="none";
    alert("โ ุญุฏุซ ุฎุทุฃ");
  });
}
</script>

</body>
</html>

