<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Tajawal,Arial;
  margin:0;
  background:
    linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.45)),
    url("https://i.supaimg.com/c5d71aa9-c2b3-4263-8bd6-2f800145c063.jpg")
    center/cover fixed no-repeat;
}
header{
  height:60px;
  background:#8b0000;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.container{
  max-width:540px;
  background:rgba(255,255,255,.95);
  margin:30px auto;
  padding:25px;
  border-radius:18px;
}
h2{
  color:#8b0000;
  text-align:center;
}

input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  background:#8b0000;
  color:#fff;
  cursor:pointer;
}

.welcome{
  background:#f8f4ef;
  padding:18px;
  border-radius:14px;
  margin-bottom:15px;
  line-height:1.9;
}
.welcome strong{
  color:#8b0000;
}

.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:15px;
}
.actions .secondary{
  background:#555;
}
</style>
</head>

<body>

<header>
  <h2>ğŸ‘¤ ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</h2>
</header>

<div class="container">

  <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‡Ø§ØªÙ -->
  <div id="loginBox">
    <input type="tel" id="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <button onclick="loadUser()">ğŸ” Ù…ØªØ§Ø¨Ø¹Ø©</button>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø± -->
  <div id="userBox" style="display:none">

    <div class="welcome">
      ğŸŒ™ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ <strong id="welcomeName"></strong><br>
      Ù†Ø³Ø¹Ø¯ Ø¨Ø®Ø¯Ù…ØªÙƒ ÙÙŠ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ù…Ø¨Ø§Ø±ÙƒØ© ğŸ¤
    </div>

    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
    <input id="lastname" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
    <input id="airport" placeholder="Ù…Ø·Ø§Ø± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹">
    <input id="residence" placeholder="Ø§Ù„ÙˆÙ„Ø§ÙŠØ©">
    <input type="date" id="travel_date">

    <div class="actions">
      <button onclick="saveLocal()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
      <button class="secondary" onclick="goResults()">â­ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</button>
    </div>

  </div>

</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbwaPdiqpKXpPc1_GIoVo5WV98ecIK-ay2QcQzVRqrVfezFuL-vGIziHuEJVG9TtrhAQCw/exec";

let userData = null;

/* ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ */
function normalize(p){
  p = p.replace(/\D/g,"");
  if(p.startsWith("213")) p = p.slice(3);
  if(p.startsWith("0")) p = p.slice(1);
  return p;
}

/* ØªÙ†Ø¸ÙŠÙ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ (Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆÙ‚Øª) */
function cleanDate(d){
  if(!d) return "";
  return d.toString().split("T")[0];
}

/* Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø± */
function loadUser(){
  const phone = normalize(document.getElementById("phone").value);
  if(!phone){
    alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
    return;
  }

  fetch(API + "?phone=" + phone)
  .then(r => r.json())
  .then(d => {

    if(!d || d.found !== true){
      alert("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…");
      return;
    }

    userData = d;

    /* Ø­ÙØ¸ Ø§Ù„Ù‡Ø§ØªÙ */
    localStorage.setItem("umrah_phone", phone);

    /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
    loginBox.style.display = "none";
    userBox.style.display = "block";

    /* Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
    welcomeName.innerText = d.name + " " + d.lastname;

    /* ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ */
    name.value = d.name || "";
    lastname.value = d.lastname || "";
    airport.value = d.airport || "";
    residence.value = d.residence || "";
    travel_date.value = cleanDate(d.travel_date);

  })
  .catch(()=>{
    alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
  });
}

/* Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ */
function saveLocal(){
  userData.name = name.value;
  userData.lastname = lastname.value;
  userData.airport = airport.value;
  userData.residence = residence.value;
  userData.travel_date = travel_date.value;

  localStorage.setItem("umrah_user", JSON.stringify(userData));
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª");
}

/* Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
function goResults(){
  saveLocal();
  location.href = "results.html";
}
</script>

</body>
</html>