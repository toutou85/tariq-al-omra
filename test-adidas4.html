<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</title>

<style>
body{
  font-family:Tajawal,Arial;
  background:#f5f5f5;
  margin:0;
}
.container{
  max-width:650px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:14px;
}
h2{text-align:center;color:#8b0000}
.section{
  background:#f9f9f9;
  padding:15px;
  border-radius:12px;
  margin-top:15px;
}
.section h3{
  margin-top:0;
  color:#444;
  font-size:16px;
}
.row{
  margin-top:6px;
  font-size:14px;
}
button{
  width:100%;
  padding:12px;
  margin-top:20px;
  border:none;
  border-radius:10px;
  background:#8b0000;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */
#popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:9999;
  align-items:center;
  justify-content:center;
}
#popupBox{
  background:#fff;
  padding:25px;
  border-radius:12px;
  text-align:center;
  max-width:320px;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ•‹ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶</h2>

<div id="userBox" class="section">
<h3>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø±</h3>
<div id="userData">â³ ØªØ­Ù…ÙŠÙ„...</div>
</div>

<div id="offerBox" class="section">
<h3>ğŸ•‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</h3>
<div id="offerData">â³ ØªØ­Ù…ÙŠÙ„...</div>
</div>

<button onclick="send()">ğŸ“© ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø°ÙƒØ± -->
<div id="popup">
  <div id="popupBox">
    <h3 id="popTitle">â³ Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h3>
    <p id="popText">Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… ğŸ¤</p>
  </div>
</div>

<script>
const SEARCH_API="https://script.google.com/macros/s/AKfycbxMbVj_Fb7Gam2LPFOgAUpmuhy7jV9RKT_wBSVjGJ1LWyHYc_VqBoIkZZYHFEPdUY9CpA/exec";
const EMAIL_API="https://script.google.com/macros/s/AKfycbzcxJ2mvd-Nnr5mdzPItK6_3pWnX3kR_EIQuKZanjW93RGIh06d4PDqcdWwMV0AyiVB/exec";

const phone = localStorage.getItem("umrah_phone");
const offer = JSON.parse(localStorage.getItem("selected_offer") || "null");

const userData = document.getElementById("userData");
const offerData = document.getElementById("offerData");
const popup = document.getElementById("popup");
const popTitle = document.getElementById("popTitle");
const popText = document.getElementById("popText");

if(!phone || !offer){
  location.href="test-adidas2.html";
}

let userInfo = null;

/* Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø± */
fetch(SEARCH_API+"?phone="+phone)
.then(r=>r.json())
.then(d=>{
  if(!d.found){
    userData.innerHTML="âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    return;
  }
  userInfo = d;
  userData.innerHTML=`
    <div class="row">Ø§Ù„Ø§Ø³Ù…: ${d.name}</div>
    <div class="row">Ø§Ù„Ù‡Ø§ØªÙ: ${phone}</div>
    <div class="row">Ø§Ù„Ù…Ø·Ø§Ø±: ${d.airport || "-"}</div>
    <div class="row">Ø§Ù„ÙÙ†Ø¯Ù‚: ${d.hotel || "-"}</div>
    <div class="row">Ø§Ù„Ù…Ø¯Ø©: ${d.duration || "-"}</div>
  `;
});

/* Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ */
offerData.innerHTML=`
  <div class="row">ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${offer.agency || "-"}</div>
  <div class="row">âœˆï¸ Ø§Ù„Ù…Ø·Ø§Ø±: ${offer.airport || "-"}</div>
  <div class="row">ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚: ${offer.hotel || "-"}</div>
  <div class="row">â³ Ø§Ù„Ù…Ø¯Ø©: ${offer.duration || "-"}</div>
  <div class="row">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${offer.date || "-"}</div>
`;

function send(){
  if(!userInfo)return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø©");

  popup.style.display="flex";
  popTitle.innerText="â³ Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";
  popText.innerText="Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… ğŸ¤";

  fetch(EMAIL_API,{
    method:"POST",
    body:JSON.stringify({
      customer:{
        name:userInfo.name,
        phone:phone,
        airport:userInfo.airport,
        hotel:userInfo.hotel,
        duration:userInfo.duration
      },
      offer:offer
    })
  })
  .then(()=>{
    popTitle.innerText="âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ";
    popText.innerText="Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠÙƒØªØ¨ Ù„Ùƒ Ø¹Ù…Ø±Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø© ğŸŒ™";

    setTimeout(()=>{
      localStorage.clear();
      location.href="test-adidas1.html";
    },3000);
  })
  .catch(()=>{
    popTitle.innerText="âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
    popText.innerText="Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø·Ù„Ø¨Ùƒ Ù…Ø­ÙÙˆØ¸";

    setTimeout(()=>{
      location.href="test-adidas1.html";
    },3000);
  });
}
</script>

</body>
</html>
