<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø±</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f8;
  padding:20px;
}
input,button{
  padding:10px;
  font-size:16px;
}
button{
  cursor:pointer;
}
.card{
  background:#fff;
  margin-top:20px;
  padding:20px;
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
}
img{
  max-width:260px;
  margin:10px 0;
  border:1px solid #ccc;
}
.btns button{
  margin:5px;
  background:#0d6efd;
  color:#fff;
  border:none;
  border-radius:5px;
}
</style>
</head>

<body>

<h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø±</h2>

<input id="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<button onclick="search()">Ø¨Ø­Ø«</button>

<div id="result"></div>

<script>
// ğŸ”´ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Web App Ø§Ù„ØµØ­ÙŠØ­ Ù‡Ù†Ø§
const webAppUrl =
"https://script.google.com/macros/s/AKfycbxNQlPGbAZyLypzmxm9qqt5WJCA8uRCyTmtZBY8JIo01LLzB_HY1X4Odg2Cv_xcTKHmxQ/exec";

function search(){
  const phone = document.getElementById("phone").value.trim();
  if(!phone){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
    return;
  }

  fetch(webAppUrl + "?phone=" + encodeURIComponent(phone))
  .then(r => r.json())
  .then(d => {
    const box = document.getElementById("result");
    box.innerHTML = "";

    if(!d.found){
      box.innerHTML = "<p>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹ØªÙ…Ø±</p>";
      return;
    }

    box.innerHTML = `
    <div class="card" id="printArea">
      <h3>${d.firstName} ${d.lastName}</h3>

      <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${d.phone}</p>
      <p>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${d.email || "-"}</p>
      <p>ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${d.agency}</p>
      <p>ğŸ›ï¸ Ø§Ù„ØºØ±ÙØ©: ${d.roomType}</p>
      <p>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${d.price}</p>
      <p>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: ${d.wilaya}</p>
      <p>ğŸ¬ Ø§Ù„ÙØ±Ø¹: ${d.branch}</p>
      <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${d.date}</p>

      <hr>

      <h4>ğŸ›‚ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©</h4>
      <img src="${d.visaImage}" onerror="this.style.display='none'">

      <h4>ğŸ« Ø§Ù„ØªØ°ÙƒØ±Ø©</h4>
      <img src="${d.ticketImage}" onerror="this.style.display='none'">

      <div class="btns">
        <button onclick="printText()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
        <button onclick="printImages()">ğŸ–¼ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙˆØ±</button>
      </div>
    </div>`;
  })
  .catch(() => {
    document.getElementById("result").innerHTML =
      "<p>âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</p>";
  });
}

function printText(){
  const area = document.getElementById("printArea").cloneNode(true);
  area.querySelectorAll("img,.btns").forEach(e => e.remove());
  openPrint(area.innerHTML);
}

function printImages(){
  const area = document.getElementById("printArea").cloneNode(true);
  area.querySelectorAll("p,h3,h4,.btns").forEach(e => e.remove());
  openPrint(area.innerHTML);
}

function openPrint(html){
  const w = window.open("", "_blank");
  w.document.write(`
    <html>
      <head>
        <meta charset="UTF-8">
        <title>Ø·Ø¨Ø§Ø¹Ø©</title>
      </head>
      <body>${html}</body>
    </html>
  `);
  w.document.close();
  w.print();
}
</script>

</body>
</html>
