<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø±</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f8;
  padding:20px;
}
h2{
  text-align:center;
  color:#0d6efd;
}
input,button{
  padding:12px;
  font-size:16px;
  border-radius:6px;
}
input{
  width:70%;
  border:1px solid #ccc;
}
button{
  background:#0d6efd;
  color:#fff;
  border:none;
  cursor:pointer;
}
.card{
  background:#fff;
  margin-top:20px;
  padding:20px;
  border-radius:12px;
  box-shadow:0 3px 10px rgba(0,0,0,.15);
}
img{
  max-width:260px;
  border:1px solid #ccc;
  margin:10px 0;
}
.btns button{
  margin:5px;
  background:#198754;
}
.loader{
  text-align:center;
  margin-top:20px;
  font-size:18px;
  color:#555;
}

/* ====== ÙˆØ±Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø± ====== */
.print-page{
  position:relative;
  padding:30px;
}
.print-page::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    url("https://i.ibb.co/bgc4Y7gr/1766852333847.png") center 30% no-repeat,
    url("https://i.ibb.co/d8K117p/1766852254653.jpg") center 70% no-repeat;
  background-size:180px,220px;
  opacity:0.08;
}
.print-content{
  position:relative;
  z-index:1;
}

/* ====== Ù…Ù„ØµÙ‚ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© ====== */
.sticker{
  width:320px;
  height:200px;
  border:2px dashed #ff9800;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:24px;
  font-weight:bold;
  position:relative;
}
.sticker::before{
  content:"";
  position:absolute;
  inset:0;
  background:url("https://i.ibb.co/bgc4Y7gr/1766852333847.png") center no-repeat;
  background-size:120px;
  opacity:0.12;
}
.sticker div{
  position:relative;
  z-index:1;
}
</style>
</head>

<body>

<h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø±</h2>

<div style="display:flex;gap:10px;justify-content:center;">
  <input id="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <button onclick="search()">Ø¨Ø­Ø«</button>
</div>

<div id="loader" class="loader"></div>
<div id="result"></div>

<script>
const webAppUrl =
"https://script.google.com/macros/s/AKfycbxNQlPGbAZyLypzmxm9qqt5WJCA8uRCyTmtZBY8JIo01LLzB_HY1X4Odg2Cv_xcTKHmxQ/exec";

const dhikr = [
  "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡",
  "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡",
  "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡",
  "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡",
  "Ø§Ù„Ù„Ù‡Ù… ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯"
];

function search(){
  const phone = document.getElementById("phone").value.trim();
  if(!phone) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");

  const loader = document.getElementById("loader");
  let i=0;
  loader.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

  const interval = setInterval(()=>{
    loader.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«... " + dhikr[i++ % dhikr.length];
  },1000);

  fetch(webAppUrl + "?phone=" + encodeURIComponent(phone))
  .then(r=>r.json())
  .then(d=>{
    clearInterval(interval);
    loader.innerText="";

    if(!d.found){
      result.innerHTML="âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹ØªÙ…Ø±";
      return;
    }

    result.innerHTML=`
    <div class="card" id="printArea">
      <h3>${d.firstName} ${d.lastName}</h3>
      <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${d.phone}</p>
      <p>ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${d.agency}</p>
      <p>ğŸ›ï¸ Ø§Ù„ØºØ±ÙØ©: ${d.roomType}</p>
      <p>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${d.price}</p>
      <p>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: ${d.wilaya}</p>
      <p>ğŸ¬ Ø§Ù„ÙØ±Ø¹: ${d.branch}</p>
      <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${d.date}</p>

      <hr>
      <h4>ğŸ›‚ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©</h4>
      <img src="${d.visaImage}" onerror="this.style.display='none'">
      <h4>ğŸ« Ø§Ù„ØªØ°ÙƒØ±Ø©</h4>
      <img src="${d.ticketImage}" onerror="this.style.display='none'">

      <div class="btns">
        <button onclick="printData()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button onclick="printSticker()">ğŸ§³ Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„ØµÙ‚ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©</button>
      </div>
    </div>`;
  })
  .catch(()=>{
    clearInterval(interval);
    loader.innerText="âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
  });
}

function printData(){
  openPrint(`
  <div class="print-page">
    <div class="print-content">
      ${document.getElementById("printArea").innerHTML}
    </div>
  </div>
  `);
}

function printSticker(){
  const area=document.getElementById("printArea");
  const name=area.querySelector("h3").innerText;
  const agency=area.querySelector("p:nth-child(3)").innerText;
  const phone=area.querySelector("p:nth-child(2)").innerText;

  openPrint(`
    <div class="sticker">
      <div>
        ${name}<br>
        ${agency}<br>
        ${phone}
      </div>
    </div>
  `);
}

function openPrint(html){
  const w=window.open("");
  w.document.write(`<html><head><meta charset="UTF-8"></head><body>${html}</body></html>`);
  w.document.close();
  w.print();
}
</script>

</body>
</html>