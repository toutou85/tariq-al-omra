<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø±</title>

<style>
/* ========== Ø¹Ø§Ù… ========== */
body{
  font-family: Tahoma, Arial;
  background:#f2f4f8;
  padding:20px;
}
h2{text-align:center}
input,button{
  padding:10px;
  font-size:16px;
}
button{
  background:#0d6efd;
  color:#fff;
  border:none;
  cursor:pointer;
}
.card{
  background:#fff;
  padding:20px;
  margin-top:20px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
.btns button{margin:5px}

/* ========== Ø·Ø¨Ø§Ø¹Ø© A4 ========== */
@page{
  size:A4;
  margin:20mm;
}
@media print{
  body{background:white}
}

.print-a4{
  width:170mm;
}
.print-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:2px solid #000;
  padding-bottom:10px;
}
.print-header img{height:60px}
.print-title{
  font-size:20px;
  font-weight:bold;
}

.table{
  width:100%;
  border-collapse:collapse;
  margin-top:25px;
}
.table td{
  border:1px solid #000;
  padding:8px;
}
.table .label{
  width:35%;
  font-weight:bold;
  background:#f1f1f1;
}

/* ========== Ù…Ù„ØµÙ‚ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© ========== */
.sticker{
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  font-weight:bold;
}
.sticker .name{font-size:56px}
.sticker .agency{font-size:38px;margin:15px 0}
.sticker .phone{font-size:32px}
</style>
</head>

<body>

<h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø±</h2>

<input id="phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<button onclick="search()">Ø¨Ø­Ø«</button>

<div id="result"></div>

<script>
// ğŸ”´ Ø±Ø§Ø¨Ø· Google Apps Script
const webAppUrl =
"https://script.google.com/macros/s/AKfycbxNQlPGbAZyLypzmxm9qqt5WJCA8uRCyTmtZBY8JIo01LLzB_HY1X4Odg2Cv_xcTKHmxQ/exec";

// Ø´Ø¹Ø§Ø±Ø§Øª
const logoAgency = "https://i.ibb.co/d8K117p/1766852254653.jpg";
const logoPath = "https://i.ibb.co/bgc4Y7gr/1766852333847.png";

let data = null;

function search(){
  const phone = document.getElementById("phone").value.trim();
  if(!phone) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");

  fetch(webAppUrl+"?phone="+encodeURIComponent(phone))
  .then(r=>r.json())
  .then(d=>{
    if(!d.found){
      result.innerHTML="âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹ØªÙ…Ø±";
      return;
    }
    data=d;

    result.innerHTML=`
    <div class="card">
      <h3>${d.firstName} ${d.lastName}</h3>
      <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${d.phone}</p>
      <p>ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${d.agency}</p>
      <p>ğŸ›ï¸ Ø§Ù„ØºØ±ÙØ©: ${d.roomType}</p>
      <p>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${d.price || "-"}</p>
      <p>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: ${d.wilaya}</p>
      <p>ğŸ¬ Ø§Ù„ÙØ±Ø¹: ${d.branch}</p>
      <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${d.date || "-"}</p>

      <p>ğŸ›‚ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©: ${d.visaImage ? "ØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§" : "Ù„Ù… ÙŠØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ Ø¨Ø¹Ø¯"}</p>
      <p>ğŸ« Ø§Ù„ØªØ°ÙƒØ±Ø©: ${d.ticketImage ? "ØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§" : "Ù„Ù… ÙŠØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ Ø¨Ø¹Ø¯"}</p>

      <div class="btns">
        <button onclick="printData()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø±</button>
        <button onclick="printSticker()">ğŸ§³ Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„ØµÙ‚ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©</button>
      </div>
    </div>`;
  });
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
function printData(){
  const d=data;
  openPrint(`
  <div class="print-a4">
    <div class="print-header">
      <img src="${logoAgency}">
      <div class="print-title">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ØªÙ…Ø±</div>
      <img src="${logoPath}">
    </div>

    <table class="table">
      <tr><td class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</td><td>${d.firstName} ${d.lastName}</td></tr>
      <tr><td class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</td><td>${d.phone}</td></tr>
      <tr><td class="label">Ø§Ù„ÙˆÙƒØ§Ù„Ø©</td><td>${d.agency}</td></tr>
      <tr><td class="label">Ù†ÙˆØ¹ Ø§Ù„ØºØ±ÙØ©</td><td>${d.roomType}</td></tr>
      <tr><td class="label">Ø§Ù„Ø³Ø¹Ø±</td><td>${d.price || "-"}</td></tr>
      <tr><td class="label">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</td><td>${d.wilaya}</td></tr>
      <tr><td class="label">Ø§Ù„ÙØ±Ø¹</td><td>${d.branch}</td></tr>
      <tr><td class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</td><td>${d.date || "-"}</td></tr>
      <tr><td class="label">Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©</td><td>${d.visaImage ? "ØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§" : "Ù„Ù… ÙŠØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ Ø¨Ø¹Ø¯"}</td></tr>
      <tr><td class="label">Ø§Ù„ØªØ°ÙƒØ±Ø©</td><td>${d.ticketImage ? "ØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§" : "Ù„Ù… ÙŠØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ Ø¨Ø¹Ø¯"}</td></tr>
    </table>
  </div>
  `);
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„ØµÙ‚ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© ===== */
function printSticker(){
  const d=data;
  openPrint(`
    <div class="sticker">
      <div class="name">${d.firstName} ${d.lastName}</div>
      <div class="agency">${d.agency}</div>
      <div class="phone">${d.phone}</div>
    </div>
  `);
}

function openPrint(html){
  const w=window.open("");
  w.document.write(`<html><head><meta charset="UTF-8"></head><body>${html}</body></html>`);
  w.document.close();
  w.print();
}
</script>

</body>
</html>