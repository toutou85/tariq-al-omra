<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø± | Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ø±Ø©</title>

<style>
*{box-sizing:border-box}
body{
  font-family:'Tajawal',Tahoma,Arial,sans-serif;
  margin:0;
  background:#f2f4f8;
}

/* ===== TOP BAR ===== */
.topbar{
  background:#FFD700;
  padding:12px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:sticky;
  top:0;
  z-index:1000;
}
.menu-btn{font-size:26px;font-weight:900;cursor:pointer}

/* ===== PAGE ===== */
.page{max-width:900px;margin:30px auto;padding:15px}
.card{
  background:#fff;
  padding:24px;
  border-radius:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
}
input,button{padding:14px;font-size:18px}
button{
  background:#0d6efd;
  color:#fff;
  border:none;
  cursor:pointer;
}
.btns button{margin:10px}

/* ===== PRINT A4 ===== */
@page{size:A4;margin:20mm}
@media print{body{background:white}}

.print-a4{width:1000mm}

/* ===== HEADER ===== */
.print-header{
  display:flex;
  justify-content:space-between;
  align-
}

.logos img{
  width:20px;          /* Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø´Ø¹Ø§Ø±Ø§Øª */
  max-width:10%;
  height:auto;
  object-fit:contain;
  filter: drop-shadow(0 3px 2px rgba(0,0,0,.4));
  transition: all .3s ease;
}

/* ØªØ£Ø«ÙŠØ± Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
.logos img:hover{
  transform:scale(1.08);
}

/* ===== Ù…ÙˆØ¨Ø§ÙŠÙ„ ===== */
@media (max-width:768px){
  .logos img{
    width:80px;
  }
}

/* ===== Ù…ÙˆØ¨Ø§ÙŠÙ„ ØµØºÙŠØ± ===== */
@media (max-width:480px){
  .logos img{
    width:65px;
  }
}





/* ================== PRINT PAGE ================== */
@page{
  size: A4 landscape;
  margin: 15mm;
}

@media print{
  body{
    background:white;
  }
}

/* ================== HEADER ================== */
.print-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:2px solid #000;
  padding-bottom:10px;
}
.print-header img{
  height:60px;
}
.print-title{
  font-size:20px;
  font-weight:bold;
}

/* ================== TABLE ================== */
.table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  font-size:16px;
}
.table td{
  border:1px solid #000;
  padding:10px;
}
.table .label{
  font-weight:bold;
  width:30%;
  background:#f3f3f3;
}

/* ================== STICKER ================== */
.sticker{
  width:100%;
  text-align:center;
  font-weight:bold;
  direction:rtl;
}

/* Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
.sticker-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}
.sticker-header img{
  height:90px;
}

/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„ØµÙ‚ */
.sticker .name{
  font-size:64px;
  margin:20px 0;
}
.sticker .agency{
  font-size:60px;
  margin:20px 0;
}
.sticker .phone{
  font-size:50px;
  margin-top:20px;
}

/* ================== LOGOS ================== */
.logos{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:20px;
  margin:20px 0;
}
.logos img{
  width:30px;
  height:auto;
  object-fit:contain;
  filter:drop-shadow(0 2px 2px rgba(0,0,0,.3));
}

/* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width:768px){
  .logos img{ width:26px; }
}
@media (max-width:480px){
  .logos img{ width:22px; }
}
</style>
</head>

<body>

<div class="topbar">
  <span class="menu-btn">â˜°</span>
  <strong>ğŸ•‹ Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ø±Ø©</strong>
</div>

<div class="page">
  <div class="card">
    <h3 style="font-size:22px">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø±</h3>

    <input
      id="phone"
      type="tel"
      placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ "
      maxlength="10"
      onfocus="fixZero(this)"
      oninput="fixZero(this)"
    >

    <button onclick="search()">Ø¨Ø­Ø«</button>

    <div id="waitBox" style="display:none;margin-top:20px;padding:20px;background:#f9f9f9;border-radius:12px;text-align:center;font-size:20px;font-weight:bold;color:#0d6efd;">
      â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«â€¦<br>
      <span id="dhikr">Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡</span>
    </div>

    <div id="result"></div>
  </div>
</div>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbxNQlPGbAZyLypzmxm9qqt5WJCA8uRCyTmtZBY8JIo01LLzB_HY1X4Odg2Cv_xcTKHmxQ/exec";
const mainLogo = "https://i.ibb.co/HDMQfZKG/1766852333847-removebg-preview.png";

function getAgencyLogo(name=""){
  name=name.replace(/\s+/g,"");
  if(name.includes("ØªÙ‚Ø±Øª")) return "https://i.ibb.co/2XWLPsc/1766858356356-removebg-preview.png";
  if(name.includes("Ø§Ù„Ø§Ù†Ø³ÙŠØ©")) return "https://i.ibb.co/Mk97KqGK/FB-IMG-1766861138141-removebg-preview.png";
  if(name.includes("Ø§Ù„Ø³Ù‚ÙŠÙØ©")) return "https://i.ibb.co/mmrx9QG/FB-IMG-1766861105309-removebg-preview.png";
  return "";
}

let data=null;
const result = document.getElementById("result");

function fixZero(input){
  input.value = input.value.replace(/[^0-9]/g,"");
  if(input.value.length === 1 && input.value !== "0") input.value = "0";
}

function preparePhone(p){
  p=p.replace(/\D/g,"");
  if(p.startsWith("0")) p=p.slice(1);
  if(p.startsWith("213")) p=p.slice(3);
  return p;
}

function statusBlock(url){
  return url
    ? `<span class="status-ok">ØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§</span> <a class="download-btn" href="${url}" target="_blank">â¬‡ ØªØ­Ù…ÙŠÙ„</a>`
    : `<span class="status-no">Ù„Ù… ÙŠØªÙ… Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ Ø¨Ø¹Ø¯</span>`;
}

const adhkar = [
  "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡",
  "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡",
  "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡",
  "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡",
  " Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±"
];
let dhikrTimer=null;

function startWaiting(){
  const box=document.getElementById("waitBox");
  const text=document.getElementById("dhikr");
  let i=0;
  box.style.display="block";
  dhikrTimer=setInterval(()=>text.innerText=adhkar[i++%adhkar.length],1500);
}

function stopWaiting(){
  clearInterval(dhikrTimer);
  document.getElementById("waitBox").style.display="none";
}

function search(){
  const phone=preparePhone(document.getElementById("phone").value);
  if(phone.length<9){alert("Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­");return;}
  startWaiting();
  fetch(webAppUrl+"?phone="+phone)
    .then(r=>r.json())
    .then(d=>{
      stopWaiting();
      if(!d.found){result.innerHTML="âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ±";return;}
      data=d;
      result.innerHTML=`
      <hr>
      <p><b>Ø§Ù„Ø§Ø³Ù…:</b> ${d.firstName} ${d.lastName}</p>
      <p><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${d.phone}</p>
      <p><b>Ø§Ù„ÙˆÙƒØ§Ù„Ø©:</b> ${d.agency}</p>
      <p><b>Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©:</b> ${statusBlock(d.visaImage)}</p>
      <p><b>Ø§Ù„ØªØ°ÙƒØ±Ø©:</b> ${statusBlock(d.ticketImage)}</p>
      <div class="btns">
        <button onclick="printData()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        <button onclick="printSticker()">ğŸ§³ Ù…Ù„ØµÙ‚</button>
      </div>`;
    });
}

function openPrint(html){
  const w=window.open("");
  w.document.write(`<html><head><meta charset="UTF-8"></head><body>${html}</body></html>`);
  w.document.close();
  w.print();
}

function printData(){
  if(!data) return;
  openPrint(`
  <div class="print-a3">
    <div class="print-header">
      <img src="${mainLogo}">
      <div class="print-title">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ù…Ø¹ØªÙ…Ø±</div>
      <img src="${getAgencyLogo(data.agency)}">
    </div>
    <table class="table">
      <tr><td class="label">Ø§Ù„Ø§Ø³Ù…</td><td>${data.firstName} ${data.lastName}</td></tr>
      <tr><td class="label">Ø§Ù„Ù‡Ø§ØªÙ</td><td>${data.phone}</td></tr>
      <tr><td class="label">Ø§Ù„ÙˆÙƒØ§Ù„Ø©</td><td>${data.agency}</td></tr>
    </table>
  </div>`);
}

function printSticker(){
  if(!data) return;
  openPrint(`
  <div class="sticker">
    <div class="sticker-header">
      <img src="${mainLogo}">
      <img src="${getAgencyLogo(data.agency)}">
    </div>

    <div class="name">${data.firstName} ${data.lastName}</div>
    <div class="agency">${data.agency}</div>
    <div class="phone">${data.phone}</div>
  </div>
  `);
}
</script>

</body>
</html>