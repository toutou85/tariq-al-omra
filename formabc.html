<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>نموذج تسجيل العمرة</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }.step {
  display: none;
  padding: 20px;
}

.step.active {
  display: block;
}

.buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.form-section {
  background: white;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  padding: 20px;
  margin: 20px;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  margin-bottom: 20px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

h2 {
  margin-bottom: 20px;
  color: #333;
}

button {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #007bff;
  color: white;
  font-size: 16px;
}

button:hover {
  background: #0056b3;
}

.remove-companion-btn {
  background: red;
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  margin-bottom: 10px;
}

  </style>
</head>
<body>
  <form id="umrahForm">
    <!-- <!-- الخطوة 2: بيانات الزبون -->
<div class="form-step" id="step2" style="display: none;">
  <h2>معلومات الزبون</h2>

  <label for="firstName">الاسم:</label>
  <input type="text" id="firstName" name="firstName" required>

  <label for="lastName">اللقب:</label>
  <input type="text" id="lastName" name="lastName" required>

  <label for="phone">رقم الهاتف:</label>
  <input type="tel" id="phone" name="phone" required>

  <label for="email">البريد الإلكتروني:</label>
  <input type="email" id="email" name="email" required>

  <label for="age">العمر:</label>
  <input type="number" id="age" name="age" min="0" required>

  <label for="passportExpiry">تاريخ انتهاء جواز السفر:</label>
  <input type="date" id="passportExpiry" name="passportExpiry" required>

  <div class="step-buttons">
    <button type="button" onclick="prevStep()">السابق</button>
    <button type="button" onclick="nextStep()">التالي</button>
  </div>


<!-- الخطوة 3: الولاية والفرع -->
<div class="form-step" id="step3" style="display: none;">
  <h2>اختيار الولاية والفرع</h2>

  <label for="wilaya">الولاية:</label>
  <select id="wilaya" name="wilaya" required>
    <option value="">-- اختر الولاية --</option>
    <!-- سيتم إدراج الـ58 ولاية لاحقًا -->
  </select>

  <label for="branch">الفرع الأقرب:</label>
  <select id="branch" name="branch" required>
    <option value="">-- اختر الفرع --</option>
    <!-- سيتم ملء الفروع تلقائيًا حسب الوكالة -->
  </select>

  <div class="step-buttons">
    <button type="button" onclick="prevStep()">السابق</button>
    <button type="button" onclick="nextStep()">التالي</button>
  </div>

<!-- الخطوة 4: إضافة مرافقين -->
<div class="form-step" id="step4" style="display: none;">
  <h2>المرافقون</h2>
  <div id="companionsList"></div>

  <button type="button" onclick="addCompanion()">➕ إضافة مرافق</button>

  <div class="step-buttons">
    <button type="button" onclick="prevStep()">السابق</button>
    <button type="button" onclick="nextStep()">التالي</button>
  </div>
</div>

<!-- الخطوة 5: تأكيد المعلومات -->
<div class="step" id="step5">
  <h2>الموافقة على الشروط</h2>
  <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
    <p>يرجى قراءة الشروط التالية بعناية...</p>
    <!-- يمكنك استيراد نص from about.html هنا -->
  </div>

  <label>
    <input type="checkbox" id="agree" required> أوافق على الشروط والأحكام
  </label>

  <button type="button" onclick="prevStep()">السابق</button>
  <button type="submit">إرسال الطلب</button>
</div>

</div>سيتم ملء النموذج هنا -->
  </form>  <div id="companions"></div>  <script>

<script>
document.getElementById("umrahForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);
  formData.append("companionCount", companionCount);

  fetch("https://script.google.com/macros/s/PASTE_YOUR_DEPLOYED_URL_HERE/exec", {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(response => {
    alert("تم إرسال تسجيلكم بنجاح!");
    window.location.href = "index.html"; // إعادة التوجيه
  })
  .catch(err => {
    alert("حدث خطأ أثناء الإرسال: " + err.message);
  });
});
</script>

<script>
// 🔄 التنقل بين الخطوات
let currentStep = 0;
const steps = document.querySelectorAll('.step');

function showStep(index) {
  steps.forEach((step, i) => {
    step.style.display = i === index ? 'block' : 'none';
  });
}

function nextStep() {
  const inputs = steps[currentStep].querySelectorAll('input, select');
  for (let input of inputs) {
    if (input.hasAttribute('required') && !input.value) {
      alert('يرجى ملء جميع الحقول المطلوبة');
      return;
    }
  }
  if (currentStep < steps.length - 1) {
    currentStep++;
    showStep(currentStep);
  }
}

function prevStep() {
  if (currentStep > 0) {
    currentStep--;
    showStep(currentStep);
  }
}

showStep(currentStep);

// 🏢 استخراج اسم الوكالة من الرابط + عرض الفروع المناسبة
const urlParams = new URLSearchParams(window.location.search);
const agency = urlParams.get("agency");
document.getElementById("agencyName").value = agency || '';

const branches = {
  "النجاح": ["الدار البيضاء", "برج الكيفان", "باب الزوار", "وهران", "قسنطينة"],
  "صفا ومروة": ["تيارت", "تيسمسيلت", "غليزان", "سيدي بلعباس", "الشلف"],
  "البيت الجميل": ["بوفاريك", "البليدة", "الأبيار", "باب الزوار", "بومرداس"]
};

const branchSelect = document.getElementById("branch");
if (agency && branches[agency]) {
  branches[agency].forEach(branch => {
    const option = document.createElement("option");
    option.value = branch;
    option.textContent = branch;
    branchSelect.appendChild(option);
  });
}

// 🧒 إضافة مرافقين
let companionCount = 0;
function addCompanion() {
  companionCount++;
  const container = document.getElementById("companionsContainer");
  const div = document.createElement("div");
  div.innerHTML = `
    <fieldset style="margin: 10px 0; border: 1px solid #ccc; padding: 10px;">
      <legend>المرافق ${companionCount}</legend>
      <label>الصفة:</label>
      <select name="companionRelation${companionCount}" required>
        <option value="">اختر</option>
        <option value="زوجة">زوجة</option>
        <option value="ابن">ابن</option>
        <option value="صديق">صديق</option>
        <option value="طفل أقل من سنتين">طفل أقل من سنتين</option>
        <option value="طفل بين 2 و12 سنة">طفل بين 2 و12 سنة</option>
      </select>
      <label>الاسم الكامل:</label>
      <input type="text" name="companionName${companionCount}" required>
      <label>تاريخ الميلاد:</label>
      <input type="date" name="companionBirth${companionCount}" required>
      <label>تاريخ انتهاء جواز السفر:</label>
      <input type="date" name="companionPassport${companionCount}" required>
      <button type="button" onclick="this.parentElement.remove()">🗑️ إزالة</button>
    </fieldset>
  `;
  container.appendChild(div);
}
</script>

    // هنا يتم تحميل النموذج من ملف خارجي أو بناءه مباشرة
    // لتبسيط المثال نعتبر أن النموذج موجود ومُهيأ
  </script></body>
</html>