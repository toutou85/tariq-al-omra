<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل العمرة</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f5f5f5;
      font-family: 'Tahoma', sans-serif;
    }
    .container {
      max-width: 700px;
      margin-top: 20px;
      margin-bottom: 40px;
      background: #fff;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    h2 {
      color: #007bff;
      margin-bottom: 20px;
    }
    .form-step {
      display: none;
    }
    .form-step.active {
      display: block;
    }
    .step-buttons {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="text-center">نموذج تسجيل العمرة</h2>
  <form id="umrahForm">
    <!-- الخطوة 1: معلومات العرض -->
    <div class="form-step active">
      <div class="mb-3">
        <label for="agency" class="form-label">اسم الوكالة</label>
        <input type="text" id="agency" name="agency" class="form-control" readonly>
      </div>
      <div class="mb-3">
        <label for="offerID" class="form-label">رقم العرض</label>
        <input type="text" id="offerID" name="offerID" class="form-control" readonly>
      </div>
    </div><!-- الخطوة 2: بيانات الزبون -->
<div class="form-step">
  <div class="mb-3">
    <label class="form-label">الاسم</label>
    <input type="text" name="firstName" class="form-control" required>
  </div>
  <div class="mb-3">
    <label class="form-label">اللقب</label>
    <input type="text" name="lastName" class="form-control" required>
  </div>
  <div class="mb-3">
    <label class="form-label">الهاتف</label>
    <input type="tel" name="phone" class="form-control" required>
  </div>
  <div class="mb-3">
    <label class="form-label">البريد الإلكتروني</label>
    <input type="email" name="email" class="form-control">
  </div>
  <div class="mb-3">
    <label class="form-label">العمر</label>
    <input type="number" name="age" class="form-control">
  </div>
  <div class="mb-3">
    <label class="form-label">تاريخ انتهاء جواز السفر</label>
    <input type="date" name="passportExpiry" class="form-control">
  </div>
</div>

<!-- الخطوة 3: الولاية والفرع -->
<div class="form-step">
  <div class="mb-3">
    <label class="form-label">الولاية</label>
    <select name="wilaya" class="form-select">
      <option value="أدرار">أدرار</option>
      <option value="الشلف">الشلف</option>
      <option value="الأغواط">الأغواط</option>
      <option value="أم البواقي">أم البواقي</option>
      <option value="باتنة">باتنة</option>
      <option value="بجاية">بجاية</option>
      <option value="بسكرة">بسكرة</option>
      <option value="بشار">بشار</option>
      <option value="البليدة">البليدة</option>
      <option value="البويرة">البويرة</option>
      <option value="تمنراست">تمنراست</option>
      <option value="تبسة">تبسة</option>
      <option value="تلمسان">تلمسان</option>
      <option value="تيارت">تيارت</option>
      <option value="تيزي وزو">تيزي وزو</option>
      <option value="الجزائر">الجزائر</option>
      <option value="الجلفة">الجلفة</option>
      <option value="جيجل">جيجل</option>
      <option value="سطيف">سطيف</option>
      <option value="سعيدة">سعيدة</option>
      <option value="سكيكدة">سكيكدة</option>
      <option value="سيدي بلعباس">سيدي بلعباس</option>
      <option value="عنابة">عنابة</option>
      <option value="قالمة">قالمة</option>
      <option value="قسنطينة">قسنطينة</option>
      <option value="المدية">المدية</option>
      <option value="مستغانم">مستغانم</option>
      <option value="المسيلة">المسيلة</option>
      <option value="معسكر">معسكر</option>
      <option value="ورقلة">ورقلة</option>
      <option value="وهران">وهران</option>
      <option value="البيض">البيض</option>
      <option value="إليزي">إليزي</option>
      <option value="برج بوعريريج">برج بوعريريج</option>
      <option value="بومرداس">بومرداس</option>
      <option value="الطارف">الطارف</option>
      <option value="تندوف">تندوف</option>
      <option value="تيسمسيلت">تيسمسيلت</option>
      <option value="الوادي">الوادي</option>
      <option value="خنشلة">خنشلة</option>
      <option value="سوق أهراس">سوق أهراس</option>
      <option value="تيبازة">تيبازة</option>
      <option value="ميلة">ميلة</option>
      <option value="عين الدفلى">عين الدفلى</option>
      <option value="النعامة">النعامة</option>
      <option value="عين تموشنت">عين تموشنت</option>
      <option value="غرداية">غرداية</option>
      <option value="غليزان">غليزان</option>
      <option value="تميمون">تميمون</option>
      <option value="برج باجي مختار">برج باجي مختار</option>
      <option value="أولاد جلال">أولاد جلال</option>
      <option value="بني عباس">بني عباس</option>
      <option value="عين صالح">عين صالح</option>
      <option value="عين قزام">عين قزام</option>
      <option value="تقرت">تقرت</option>
      <option value="جانت">جانت</option>
      <option value="المغير">المغير</option>
      <option value="المنيعة">المنيعة</option>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">اختر الفرع الأقرب</label>
    <select name="branch" class="form-select" id="branchSelect">
      <!-- يتم تعبئتها ديناميكياً حسب الوكالة -->
    </select>
  </div>
</div>

<!-- الخطوة 4: إضافة مرافقين -->
<div class="form-step">
  <div id="companionsSection"></div>
  <button type="button" class="btn btn-secondary" onclick="addCompanion()">إضافة مرافق</button>
</div>

<!-- الخطوة 5: الموافقة على الشروط -->
<div class="form-step">
  <div class="mb-3">
    <label class="form-label">يرجى قراءة صفحة "من نحن" قبل الإرسال</label>
    <iframe src="about.html" width="100%" height="200"></iframe>
  </div>
  <div class="form-check">
    <input type="checkbox" class="form-check-input" id="agree" required>
    <label class="form-check-label" for="agree">أوافق على الشروط والأحكام</label>
  </div>
</div>

<!-- الأزرار -->
<div class="step-buttons d-flex justify-content-between">
  <button type="button" class="btn btn-outline-primary" onclick="prevStep()">السابق</button>
  <button type="button" class="btn btn-primary" onclick="nextStep()">التالي</button>
  <button type="submit" class="btn btn-success d-none" id="submitBtn">إرسال</button>
</div>

  </form>
</div><script>
  const urlParams = new URLSearchParams(window.location.search);
  const agency = urlParams.get('agency');
  const offerID = urlParams.get('offerID');
  document.getElementById('agency').value = agency || '';
  document.getElementById('offerID').value = offerID || '';

  const steps = document.querySelectorAll(".form-step");
  let currentStep = 0;
  function showStep(step) {
    steps.forEach((el, index) => {
      el.classList.toggle("active", index === step);
    });
    document.getElementById("submitBtn").classList.toggle("d-none", step !== steps.length - 1);
  }
  function nextStep() {
    if (currentStep < steps.length - 1) {
      currentStep++;
      showStep(currentStep);
    }
  }
  function prevStep() {
    if (currentStep > 0) {
      currentStep--;
      showStep(currentStep);
    }
  }

  function addCompanion() {
    const container = document.createElement("div");
    container.className = "border p-3 my-2 rounded";
    container.innerHTML = `
      <div class="mb-2">
        <label>صفة المرافق</label>
        <select name="companionRole[]" class="form-select">
          <option value="زوجة">زوجة</option>
          <option value="ابن">ابن</option>
          <option value="ابنة">ابنة</option>
          <option value="أخ">أخ</option>
          <option value="أخت">أخت</option>
          <option value="صديق">صديق</option>
          <option value="طفل أقل من سنتين">طفل أقل من سنتين</option>
          <option value="طفل بين 2 و12 سنة">طفل بين 2 و12 سنة</option>
        </select>
      </div>
      <div class="mb-2">
        <input type="text" name="companionFirstName[]" class="form-control" placeholder="الاسم">
      </div>
      <div class="mb-2">
        <input type="text" name="companionLastName[]" class="form-control" placeholder="اللقب">
      </div>
      <div class="mb-2">
        <input type="tel" name="companionPhone[]" class="form-control" placeholder="الهاتف">
      </div>
      <div class="mb-2">
        <input type="number" name="companionAge[]" class="form-control" placeholder="العمر">
      </div>
      <div class="mb-2">
        <input type="date" name="companionPassportExpiry[]" class="form-control" placeholder="تاريخ انتهاء الجواز">
      </div>
    `;
    document.getElementById("companionsSection").appendChild(container);
  }

  document.getElementById("umrahForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const formData = new FormData(this);
    fetch("https://script.google.com/macros/s/AKfycbx7w7TzP54ldVbS7K5BSDq7nn0cozGPryG5ODpNrjj3xY3LIWej5fCcA4Kkt60SAfo7/exec", {
      method: "POST",
      body: formData
    })
      .then(res => res.text())
      .then(data => {
        alert("تم إرسال طلبك بنجاح");
        location.reload();
      })
      .catch(err => alert("حدث خطأ: " + err));
  });
</script></body>
</html>