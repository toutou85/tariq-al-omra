<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ุชุณุฌูู ุงูุนูุฑุฉ</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
    }
    .step { margin-bottom: 30px; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; color: #333; }
    label { display: block; margin-top: 10px; }
    input, select {
      width: 100%; padding: 8px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 5px;
    }
    .mrafiq { border-top: 1px dashed #ccc; margin-top: 20px; padding-top: 10px; }
    .remove-btn {
      background: #e74c3c; color: #fff;
      border: none; padding: 5px 10px; margin-top: 10px;
      border-radius: 5px; cursor: pointer;
    }
    button[type="submit"], #addMrafiq {
      background-color: #2ecc71;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      display: block;
      width: 100%;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

<form id="omraForm">
  <!-- ุงูุฎุทูุฉ 1: ุงูุนุฑุถ -->
  <div class="step">
    <h2>ูุนูููุงุช ุงูุนุฑุถ</h2>
    <label>ุงุณู ุงูููุงูุฉ:</label>
    <input type="text" id="agencyName" name="agencyName" readonly />
    <label>ุฑูู ุงูุนุฑุถ:</label>
    <input type="text" id="offerID" name="offerID" readonly />
  </div>

  <!-- ุงูุฎุทูุฉ 2: ุจูุงูุงุช ุงูุฒุจูู -->
  <div class="step">
    <h2>ูุนูููุงุช ุงูุฒุจูู</h2>
    <label>ุงูุงุณู:</label>
    <input type="text" name="name" required />
    <label>ุงูููุจ:</label>
    <input type="text" name="surname" required />
    <label>ุฑูู ุงููุงุชู:</label>
    <input type="tel" name="phone" required />
    <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
    <input type="email" name="email" />
    <label>ุงูุนูุฑ:</label>
    <input type="number" name="age" />
    <label>ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฌูุงุฒ:</label>
    <input type="date" name="passportExpiry" />
  </div>

  <!-- ุงูุฎุทูุฉ 3: ุงูููุงูุฉ ูุงููุฑุน -->
  <div class="step">
    <h2>ููุงู ุงูุฅูุงูุฉ</h2>
    <label>ุงูููุงูุฉ:</label>
    <select name="wilaya" id="wilayaSelect" required>
      <option value="" disabled selected>ุงุฎุชุฑ ููุงูุชู</option>
      <!-- ุฃุถู 58 ููุงูุฉ -->
      <option value="ุฃุฏุฑุงุฑ">ุฃุฏุฑุงุฑ</option>
      <option value="ุงูุดูู">ุงูุดูู</option>
      <option value="ุงูุฃุบูุงุท">ุงูุฃุบูุงุท</option>
      <option value="ุฃู ุงูุจูุงูู">ุฃู ุงูุจูุงูู</option>
      <!-- ... ุญุชู ... -->
      <option value="ุงูุฌุฒุงุฆุฑ">ุงูุฌุฒุงุฆุฑ</option>
      <option value="ุงูุทุงุฑู">ุงูุทุงุฑู</option>
      <option value="ุชูุฏูู">ุชูุฏูู</option>
      <option value="ุชูุจุงุฒุฉ">ุชูุจุงุฒุฉ</option>
      <option value="ูููุฉ">ูููุฉ</option>
      <option value="ุนูู ุงูุฏููู">ุนูู ุงูุฏููู</option>
      <option value="ุงููุนุงูุฉ">ุงููุนุงูุฉ</option>
      <option value="ุบุฑุฏุงูุฉ">ุบุฑุฏุงูุฉ</option>
      <option value="ุบููุฒุงู">ุบููุฒุงู</option>
    </select>

    <label>ุงููุฑุน ุงูุฃูุฑุจ:</label>
    <select name="branch" id="branchSelect" required>
      <option value="">ุงุฎุชุฑ ูุฑุนู</option>
    </select>
  </div>

  <!-- ุงูุฎุทูุฉ 4: ุงููุฑุงูููู -->
  <div class="step">
    <h2>ุงููุฑุงูููู</h2>
    <div id="mrafiqContainer"></div>
    <button type="button" id="addMrafiq">โ ุฅุถุงูุฉ ูุฑุงูู</button>
  </div>

  <!-- ุงูุฎุทูุฉ 5: ุงูุฅุฑุณุงู -->
  <div class="step">
    <h2>ุชุฃููุฏ ุงูุทูุจ</h2>
    <label><input type="checkbox" required /> ุฃูุงูู ุนูู ุงูุดุฑูุท ูุงูุฃุญูุงู</label>
    <button type="submit">๐ค ุฅุฑุณุงู ุงูุทูุจ</button>
  </div>
</form>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const agency = urlParams.get("agency");
  const offerID = urlParams.get("offerID");
  document.getElementById("agencyName").value = agency || "";
  document.getElementById("offerID").value = offerID || "";

  const branches = {
    "ููุงูุฉ ุงูุณูููุฉ ููุณูุงุญุฉ ู ุณูุฑ": ["ุชููุณุงู", "ุนูู ุชููุดูุช", "ุจูู ุตุงู", "ูุบููุฉ"],
    "ููุงูุฉ ุชูุฑุช ููุณูุงุญุฉ ู ุณูุฑ": ["ูุฑููุฉ", "ุชูุฑุช", "ุงูุทูุจุงุช", "ุงููุงุฏู"],
    "ููุงูุฉ ุงูุฃูุฏูุณ": ["ุงูุฌุฒุงุฆุฑ", "ุงูุจููุฏุฉ", "ุจููุฑุฏุงุณ", "ุชูุจุงุฒุฉ"]
  };

  const branchSelect = document.getElementById("branchSelect");
  if (agency && branches[agency]) {
    branches[agency].forEach(branch => {
      const opt = document.createElement("option");
      opt.value = branch;
      opt.textContent = branch;
      branchSelect.appendChild(opt);
    });
  }

  // ุฅุถุงูุฉ ูุฑุงูู
  const mrafiqContainer = document.getElementById("mrafiqContainer");
  document.getElementById("addMrafiq").addEventListener("click", () => {
    const div = document.createElement("div");
    div.className = "mrafiq";
    div.innerHTML = `
      <label>ุตูุฉ ุงููุฑุงูู:</label>
      <select name="relation[]">
        <option value="ุฒูุฌ">ุฒูุฌ</option>
        <option value="ุฒูุฌุฉ">ุฒูุฌุฉ</option>
        <option value="ุงุจู">ุงุจู</option>
        <option value="ุงุจูุฉ">ุงุจูุฉ</option>
        <option value="ุฃุฎ">ุฃุฎ</option>
        <option value="ุฃุฎุช">ุฃุฎุช</option>
        <option value="ุตุฏูู">ุตุฏูู</option>
      </select>
      <label>ุงูุงุณู:</label><input type="text" name="mname[]" />
      <label>ุงูููุจ:</label><input type="text" name="msurname[]" />
      <label>ุงูุนูุฑ:</label><input type="number" name="mage[]" />
      <label>ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฌูุงุฒ:</label><input type="date" name="mpassportExpiry[]" />
      <button type="button" class="remove-btn" onclick="this.parentElement.remove()">๐๏ธ ุฅุฒุงูุฉ</button>
    `;
    mrafiqContainer.appendChild(div);
  });

  // ุงูุฅุฑุณุงู
  document.getElementById("omraForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    fetch("https://script.google.com/macros/s/AKfycbx7w7TzP54ldVbS7K5BSDq7nn0cozGPryG5ODpNrjj3xY3LIWej5fCcA4Kkt60SAfo7/exec", {
      method: "POST",
      body: formData
    })
    .then(res => res.text())
    .then(data => {
      alert("โ ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ");
      window.location.href = "index.html";
    })
    .catch(err => {
      alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงูุ ุญุงูู ูุฌุฏุฏูุง");
    });
  });
</script>
</body>
</html>