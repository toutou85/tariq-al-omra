<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:Tajawal,Arial;
  margin:0;
  background:
    linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.45)),
    url("https://i.supaimg.com/c5d71aa9-c2b3-4263-8bd6-2f800145c063.jpg")
    center/cover fixed no-repeat;
}
header{
  height:60px;
  background:#8b0000;
  color:#fff;
  display:flex;
  align-items:center;
  padding:0 15px;
}
.menu-btn{font-size:26px;cursor:pointer}
header h1{flex:1;text-align:center;font-size:18px;margin:0}

#sideMenu{
  position:fixed;top:0;right:-260px;
  width:260px;height:100%;
  background:#8b0000;
  padding-top:70px;
  transition:.3s;z-index:10000
}
#sideMenu a{
  display:block;padding:14px 18px;
  color:#fff;text-decoration:none;
  border-bottom:1px solid rgba(255,255,255,.15)
}
#sideMenu a:hover{background:rgba(255,255,255,.15)}
#overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);z-index:9000
}

.container{
  max-width:800px;
  margin:25px auto;
  background:rgba(255,255,255,.95);
  padding:22px;
  border-radius:20px;
}

.section{
  background:#f9f9f9;
  border-radius:16px;
  padding:18px;
  margin-top:15px;
}
.section h3{
  margin-top:0;
  color:#8b0000;
  font-size:17px;
}
.row{
  font-size:14px;
  margin-top:6px;
  color:#333;
}

button.main{
  width:100%;
  padding:14px;
  margin-top:22px;
  border:none;
  border-radius:12px;
  background:#8b0000;
  color:#fff;
  font-size:17px;
  cursor:pointer;
}

#popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:12000;
  align-items:center;
  justify-content:center;
}
#popupBox{
  background:#fff;
  padding:28px;
  border-radius:18px;
  text-align:center;
  max-width:340px;
}
</style>
</head>

<body>

<header>
  <div class="menu-btn" onclick="openMenu()">â˜°</div>
  <h1>ğŸ•‹ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h1>
</header>

<nav id="sideMenu">
  <a href="results-gen.html">ğŸ•‹ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ø§Ù…Ø©</a>
  <a href="recherche-oeffer.html">ğŸ“© Ø·Ù„Ø¨ Ø¹Ø±Ø¶ Ø¹Ù…Ø±Ø©</a>
  <a href="recherche-n.html">ğŸ‘¤ ØµÙØ­ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©</a>
</nav>
<div id="overlay" onclick="closeMenu()"></div>

<div class="container">

  <div class="section">
    <h3>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø±</h3>
    <div id="userData">â³ ØªØ­Ù…ÙŠÙ„...</div>
  </div>

  <div class="section">
    <h3>ğŸ•‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</h3>
    <div id="offerData">â³ ØªØ­Ù…ÙŠÙ„...</div>
  </div>

  <button class="main" onclick="send()">ğŸ“© ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<div id="popup">
  <div id="popupBox">
    <h3 id="popTitle">â³ Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h3>
    <p id="popText">Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… ğŸ¤</p>
  </div>
</div>

<script>
/* ===== APIs ===== */
const SEARCH_API="https://script.google.com/macros/s/AKfycbxMbVj_Fb7Gam2LPFOgAUpmuhy7jV9RKT_wBSVjGJ1LWyHYc_VqBoIkZZYHFEPdUY9CpA/exec";
const EMAIL_API="https://script.google.com/macros/s/AKfycbxZNnanr_r3JV5X8CatUpZcaeXltVJ75WeYXDmzjaUThgziD9nb74gzXiTaRIkK2cGW/exec";

/* ===== Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±ÙŠÙ† ===== */
let customer = null;
let offer = null;

/* 1ï¸âƒ£ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ (sessionStorage) */
const sessionData = JSON.parse(sessionStorage.getItem("umrahRequest") || "null");
if(sessionData){
  customer = {
    name: sessionData.first + " " + sessionData.last,
    phone: sessionData.phone
  };
  offer = {
    agency: sessionData.agency,
    state: sessionData.state,
    airport: sessionData.airport,
    date: sessionData.date,
    hotel: sessionData.hotel || "-",
    group: sessionData.price
  };
}

/* 2ï¸âƒ£ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (localStorage) */
if(!customer || !offer){
  const phone = localStorage.getItem("umrah_phone");
  const storedOffer = JSON.parse(localStorage.getItem("selected_offer") || "null");

  if(phone && storedOffer){
    offer = storedOffer;

    fetch(SEARCH_API+"?phone="+phone)
      .then(r=>r.json())
      .then(d=>{
        customer = {
          name: d.name,
          phone: phone,
          airport: d.airport,
          hotel: d.hotel,
          duration: d.duration
        };
        render();
      });
  }else{
    location.href="results-gen.html";
  }
}else{
  render();
}

/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
function render(){
  userData.innerHTML = `
    <div class="row">Ø§Ù„Ø§Ø³Ù…: ${customer.name}</div>
    <div class="row">Ø§Ù„Ù‡Ø§ØªÙ: ${customer.phone}</div>
  `;

  offerData.innerHTML = `
    <div class="row">Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${offer.agency || "-"}</div>
    <div class="row">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: ${offer.state || "-"}</div>
    <div class="row">Ø§Ù„Ù…Ø·Ø§Ø±: ${offer.airport || "-"}</div>
    <div class="row">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø­Ù„Ø©: ${offer.date || "-"}</div>
    <div class="row">Ø§Ù„ÙÙ†Ø¯Ù‚: ${offer.hotel || "-"}</div>
    <div class="row">Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©: ${offer.group || "-"} Ø¯Ø¬</div>
  `;
}

/* ===== Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ===== */
function send(){
  popup.style.display="flex";

  fetch(EMAIL_API,{
    method:"POST",
    body:JSON.stringify({customer,offer})
  }).then(()=>{
    popTitle.innerText="âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­";
    popText.innerText="Ù†Ø³Ø£Ù„ Ø§Ù„Ù„Ù‡ Ø£Ù† ÙŠÙƒØªØ¨ Ù„Ùƒ Ø¹Ù…Ø±Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø© ğŸŒ™";

    setTimeout(()=>{
      sessionStorage.removeItem("umrahRequest");
      localStorage.removeItem("umrah_phone");
      localStorage.removeItem("selected_offer");
      location.href="results-gen.html";
    },3000);
  });
}

function openMenu(){sideMenu.style.right="0";overlay.style.display="block"}
function closeMenu(){sideMenu.style.right="-260px";overlay.style.display="none"}
</script>

</body>
</html>
