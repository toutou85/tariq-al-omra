<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ | Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ø±Ø©</title>

  <style>
    *{box-sizing:border-box}
    body{
      font-family:'Tajawal',sans-serif;
      background:#f4f4f4;
      margin:0;
    }

    /* ===== TOP BAR ===== */
    .topbar{
      background:#FFD700;
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      position:sticky;
      top:0;
      z-index:1000;
    }
    .menu-btn{font-size:26px;font-weight:900;cursor:pointer}
    .topbar h2{margin:0;font-size:18px}

    /* ===== SIDEBAR ===== */
    .sidebar{
      height:100%;
      width:0;
      position:fixed;
      top:0;
      right:0;
      background:#fff;
      transition:.3s;
      box-shadow:-4px 0 15px rgba(0,0,0,.3);
      padding-top:60px;
      z-index:9999;
    }
    .sidebar a{
      padding:12px 20px;
      display:block;
      text-decoration:none;
      color:#333;
      font-weight:700;
    }
    .sidebar a:hover{background:#f2f2f2}
    .closebtn{
      position:absolute;
      top:10px;
      left:15px;
      font-size:28px;
      cursor:pointer;
    }

    /* ===== PAGE ===== */
    .container{
      max-width:850px;
      margin:20px auto 120px;
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,.1);
    }

    .main-img{
      width:100%;
      border-radius:12px;
      margin-bottom:20px;
    }

    h2{
      color:#d4af37;
      text-align:center;
      margin-top:0;
    }

    /* ===== AGENCY LOGO ===== */
    .agency-logo{
      width:90px;
      height:90px;
      margin:10px auto;
    }
    .agency-logo img{
      width:100%;
      height:100%;
      object-fit:contain;
    }

    ul{list-style:none;padding:0;margin:0}
    ul li{
      padding:8px 10px;
      border-bottom:1px solid #eee;
      font-size:15px;
    }

    .extra-images{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:10px;
      margin-top:20px;
    }
    .extra-images img{
      width:100%;
      height:120px;
      object-fit:cover;
      border-radius:8px;
    }

    /* ===== MODERN ACTION BAR ===== */
    .action-bar{
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      background:#fff;
      border-top:1px solid #ddd;
      display:flex;
      gap:10px;
      padding:10px;
      z-index:9999;
    }
    .action-bar button,
    .action-bar a{
      flex:1;
      border:none;
      padding:12px;
      font-size:15px;
      font-weight:900;
      border-radius:12px;
      cursor:pointer;
      text-align:center;
      text-decoration:none;
    }

    .btn-like{
      background:#fff;
      color:#e53935;
      border:2px solid #e53935;
    }
    .btn-share{
      background:linear-gradient(135deg,#0d6efd,#4dabf7);
      color:#fff;
    }
    .btn-book{
      background:linear-gradient(135deg,#28a745,#20c997);
      color:#fff;
      animation:pulse 2.5s infinite;
    }

    @keyframes pulse{
      0%{box-shadow:0 0 0 0 rgba(40,167,69,.6)}
      70%{box-shadow:0 0 0 14px rgba(40,167,69,0)}
      100%{box-shadow:0 0 0 0 rgba(40,167,69,0)}
    }

    .like-count{
      text-align:center;
      margin-top:8px;
      font-size:14px;
      color:#444;
    }
  </style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <span class="menu-btn" onclick="openSidebar()">â˜°</span>
  <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶</h2>
</div>

<!-- SIDEBAR -->
<div id="mySidebar" class="sidebar">
  <span class="closebtn" onclick="closeSidebar()">Ã—</span>
  <a href="index.html">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="offers.html">ğŸ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ø±Ø©</a>
  <a href="contact.html">ğŸ“ Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
  <a href="about.html">â” Ù…Ù† Ù†Ø­Ù†</a>
  <a href="space.html">ğŸ§¾ ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø±</a>
</div>

<div class="container" id="details-container">
  <p style="text-align:center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„...</p>
</div>

<!-- ACTION BAR -->
<div class="action-bar">
  <button class="btn-like" onclick="likeOffer()">â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨</button>
  <button class="btn-share" onclick="shareOffer()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
  <a id="bookLink" class="btn-book">ğŸŸ¢ Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</a>
</div>

<script>
const apiURL="https://script.google.com/macros/s/AKfycbxQ0REua6idTYcmfcjhD4IcbHM9k25YsTlqnWkVLRjLe0VKI-4BDIAvXzb6EviLJz7E/exec";
const id=new URLSearchParams(window.location.search).get("id");
let currentOffer=null;

/* ===== SIDEBAR FIX ===== */
const sidebar=document.getElementById("mySidebar");
function openSidebar(){sidebar.style.width="260px"}
function closeSidebar(){sidebar.style.width="0"}

/* ===== LOGO SELECTOR ===== */
function getAgencyLogo(name=""){
  name=String(name).toLowerCase().replace(/[Ø¥Ø£Ø¢]/g,"Ø§").replace(/Ø©/g,"Ù‡");
  if(name.includes("ØªÙ‚Ø±Øª")) return "https://i.ibb.co/2XWLPsc/1766858356356-removebg-preview.png";
  if(name.includes("Ø§Ù†Ø³ÙŠØ©")) return "https://i.ibb.co/Mk97KqGK/FB-IMG-1766861138141-removebg-preview.png";
  if(name.includes("Ø³Ù‚ÙŠÙ")) return "https://i.ibb.co/mmrx9QG/FB-IMG-1766861105309-removebg-preview.png";
  return "";
}

fetch(apiURL)
.then(r=>r.json())
.then(data=>{
  currentOffer=data.find(o=>o.ID==id);
  const c=document.getElementById("details-container");

  if(!currentOffer){
    c.innerHTML="<p style='color:red'>âŒ Ø§Ù„Ø¹Ø±Ø¶ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</p>";
    return;
  }

  const logo=getAgencyLogo(currentOffer["Ø§Ù„ÙˆÙƒØ§Ù„Ø©"]);

  c.innerHTML=`
    ${logo?`<div class="agency-logo"><img src="${logo}"></div>`:""}
    <img class="main-img" src="${currentOffer['Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ÙÙ†Ø¯Ù‚']}">
    <h2>${currentOffer['Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶']}</h2>

    <ul>
      <li>ğŸ¢ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${currentOffer['Ø§Ù„ÙˆÙƒØ§Ù„Ø©']}</li>
      <li>ğŸ›¬ Ø§Ù„Ù…Ø·Ø§Ø±: ${currentOffer['Ø§Ù„Ù…Ø·Ø§Ø±']}</li>
      <li>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø­Ù„Ø©: ${currentOffer['ØªØ§Ø±ÙŠØ®  Ø§Ù„Ø± Ø­Ù„Ø©']}</li>
      <li>â³ Ù…Ø¯Ø© Ø§Ù„Ø±Ø­Ù„Ø©: ${currentOffer['Ù…Ø¯Ø© Ø§Ù„Ø±Ø­Ù„Ø©']}</li>
      <li>ğŸ¨ Ø§Ù„ÙÙ†Ø¯Ù‚: ${currentOffer['Ø§Ù„ÙÙ†Ø¯Ù‚']}</li>
      <li>ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ: ${currentOffer['Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© (Ø¯Ø¬)']} Ø¯Ø¬</li>
    </ul>

    <p class="like-count">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª: <span id="like-count">${currentOffer.likes||0}</span></p>
  `;

  document.getElementById("bookLink").href=
    "formabc.html?agency="+encodeURIComponent(currentOffer['Ø§Ù„ÙˆÙƒØ§Ù„Ø©'])+
    "&offerID="+encodeURIComponent(currentOffer['ID']);
});

/* ===== LIKE ===== */
function likeOffer(){
  if(!currentOffer) return;
  fetch(apiURL+"?action=like&id="+currentOffer.ID)
  .then(r=>r.json())
  .then(r=>{
    if(r.success){
      document.getElementById("like-count").textContent=r.likes;
    }
  });
}

/* ===== SHARE ===== */
function shareOffer(){
  if(navigator.share){
    navigator.share({
      title:document.title,
      text:"ğŸŒŸ Ø´Ø§Ù‡Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù…ÙŠØ²:",
      url:location.href
    });
  }else{
    alert("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©");
  }
}
</script>

</body>
</html>