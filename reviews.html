<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø±ÙŠÙ†</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      background: #f9f9f9;
      padding: 10px;
      margin: 0;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .comment-box, .comment {
      background: #fff;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.1);
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #0056b3;
    }
    .reply-box {
      margin-right: 20px;
      margin-top: 10px;
      background: #f1f1f1;
      padding: 6px;
      border-radius: 5px;
      font-size: 13px;
    }
    .likes {
      color: #e91e63;
      margin-right: 10px;
    }
    .delete-btn {
      background: #dc3545;
    }
    .site-like {
      margin-bottom: 15px;
      text-align: center;
    }

    @media (max-width: 600px) {
      .comment-box, .comment {
        padding: 10px;
      }
      button {
        width: 20%;
        margin-top: 5px;
      }
    }
  </style>
</head>
<body>

<h2>Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø±ÙŠÙ†</h2>

<div class="site-like">
  <button onclick="likeSite()">â¤ï¸ Ø£Ø¹Ø¬Ø¨Ù†ÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
  <div id="siteLikeStatus"></div>
</div>

<div class="comment-box">
  <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
  <select id="wilaya">
    <option value="">Ø§Ø®ØªØ± ÙˆÙ„Ø§ÙŠØªÙƒ</option>
  </select>
  <textarea id="comment" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."></textarea>
  <button onclick="addComment()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
</div>

<div id="commentsContainer"></div>

<script>
  // Ø¥Ø¶Ø§ÙØ© ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±
  const wilayas = [
    "Ø£Ø¯Ø±Ø§Ø±", "Ø§Ù„Ø´Ù„Ù", "Ø§Ù„Ø£ØºÙˆØ§Ø·", "Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ", "Ø¨Ø§ØªÙ†Ø©", "Ø¨Ø¬Ø§ÙŠØ©", "Ø¨Ø³ÙƒØ±Ø©", "Ø¨Ø´Ø§Ø±", "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©", "Ø§Ù„Ø¨ÙˆÙŠØ±Ø©",
    "ØªÙ…Ù†Ø±Ø§Ø³Øª", "ØªØ¨Ø³Ø©", "ØªÙ„Ù…Ø³Ø§Ù†", "ØªÙŠØ§Ø±Øª", "ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ", "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", "Ø§Ù„Ø¬Ù„ÙØ©", "Ø¬ÙŠØ¬Ù„", "Ø³Ø·ÙŠÙ", "Ø³Ø¹ÙŠØ¯Ø©",
    "Ø³ÙƒÙŠÙƒØ¯Ø©", "Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³", "Ø¹Ù†Ø§Ø¨Ø©", "Ù‚Ø§Ù„Ù…Ø©", "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©", "Ø§Ù„Ù…Ø¯ÙŠØ©", "Ù…Ø³ØªØºØ§Ù†Ù…", "Ø§Ù„Ù…Ø³ÙŠÙ„Ø©", "Ù…Ø¹Ø³ÙƒØ±", "ÙˆØ±Ù‚Ù„Ø©",
    "ÙˆÙ‡Ø±Ø§Ù†", "Ø§Ù„Ø¨ÙŠØ¶", "Ø¥Ù„ÙŠØ²ÙŠ", "Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬", "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³", "Ø§Ù„Ø·Ø§Ø±Ù", "ØªÙ†Ø¯ÙˆÙ", "ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª", "Ø§Ù„ÙˆØ§Ø¯ÙŠ", "Ø®Ù†Ø´Ù„Ø©",
    "Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³", "ØªÙŠØ¨Ø§Ø²Ø©", "Ù…ÙŠÙ„Ø©", "Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰", "Ø§Ù„Ù†Ø¹Ø§Ù…Ø©", "Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª", "ØºØ±Ø¯Ø§ÙŠØ©", "ØºÙ„ÙŠØ²Ø§Ù†", "ØªÙ…ÙŠÙ…ÙˆÙ†", "Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±",
    "Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„", "Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³", "Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…", "ØªÙ‚Ø±Øª", "Ø¬Ø§Ù†Øª", "Ø§Ù„Ù…ØºÙŠØ±", "Ø§Ù„Ù…Ù†ÙŠØ¹Ø©", "Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡"
  ];
  const wilayaSelect = document.getElementById("wilaya");
  wilayas.forEach(w => {
    const option = document.createElement("option");
    option.value = w;
    option.textContent = w;
    wilayaSelect.appendChild(option);
  });

  const scriptURL = 'https://script.google.com/macros/s/AKfycbykykEhYdMOXIkFmw5O_obiunEWCCB6q7NE-haNvpoQz3Zx4DH1V9gDoQDeomxWlqp-/exec';
  const clientID = localStorage.getItem("clientID") || (() => {
    const id = Date.now() + "-" + Math.random().toString(36).substring(2);
    localStorage.setItem("clientID", id);
    return id;
  })();

  function addComment() {
    const name = document.getElementById("name").value.trim();
    const wilaya = document.getElementById("wilaya").value.trim();
    const comment = document.getElementById("comment").value.trim();
    if (!name || !wilaya || !comment) return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");

    fetch(scriptURL, {
      method: 'POST',
      body: new URLSearchParams({
        action: 'addComment',
        name, wilaya, comment,
        client: clientID
      })
    }).then(() => {
      document.getElementById("comment").value = "";
      getComments();
    });
  }

  function getComments() {
    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("commentsContainer");
        container.innerHTML = "";
        data.reverse().forEach(c => {
          const commentEl = document.createElement("div");
          commentEl.className = "comment";
          commentEl.innerHTML = `
            <strong>${c.name} (${c.wilaya})</strong><br>
            <small>${new Date(c.date).toLocaleString()}</small><br><br>
            ${c.comment}<br><br>
            <span class="likes">â¤ï¸ ${c.likes}</span>
            <button onclick="likeComment(${c.row})">Ø£Ø¹Ø¬Ø¨Ù†ÙŠ</button>
            <button onclick="showReply(${c.row})">Ø±Ø¯</button>
            ${c.client === clientID ? `<button class="delete-btn" onclick="deleteComment(${c.row})">ğŸ—‘ï¸ Ø­Ø°Ù</button>` : ""}
            <div class="reply-box" id="replies-${c.row}">
              ${c.replies.filter(r => r).map(r => `<div>â†ªï¸ ${r}</div>`).join("")}
            </div>
          `;
          container.appendChild(commentEl);
        });
      });
  }

  function likeComment(row) {
    fetch(scriptURL, {
      method: 'POST',
      body: new URLSearchParams({
        action: 'likeComment',
        row, client: clientID
      })
    }).then(() => getComments());
  }

  function showReply(row) {
    const reply = prompt("Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ:");
    if (reply) {
      const name = document.getElementById("name").value || "Ø²Ø§Ø¦Ø±";
      const wilaya = document.getElementById("wilaya").value || "ØŸ";
      fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams({
          action: 'addReply',
          row, reply, name, wilaya
        })
      }).then(() => getComments());
    }
  }

  function deleteComment(row) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù ØªØ¹Ù„ÙŠÙ‚ÙƒØŸ")) {
      fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams({
          action: 'deleteComment',
          row, client: clientID
        })
      }).then(() => getComments());
    }
  }

  // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
  function likeSite() {
    fetch(scriptURL, {
      method: 'POST',
      body: new URLSearchParams({
        action: 'likeSite',
        client: clientID
      })
    }).then(() => updateLikeCount());
  }

  function updateLikeCount() {
    fetch(scriptURL + "?action=getSiteLikes")
      .then(res => res.text())
      .then(count => {
        document.getElementById("siteLikeStatus").innerText = `Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹: â¤ï¸ ${count}`;
      });
  }

  window.onload = function() {
    getComments();
    updateLikeCount();
  };
</script>

</body>
</html>
